<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.14.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="万里苍穹，星辰大海">
<meta property="og:type" content="website">
<meta property="og:title" content="自由侠">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="自由侠">
<meta property="og:description" content="万里苍穹，星辰大海">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="项勇">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>自由侠</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=351441835"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":351441835,"only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">自由侠</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">项勇</p>
  <div class="site-description" itemprop="description">万里苍穹，星辰大海</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/14/2021-03-06-%E5%B8%B8%E7%94%A8%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%95%B4%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="项勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自由侠">
      <meta itemprop="description" content="万里苍穹，星辰大海">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 自由侠">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/14/2021-03-06-%E5%B8%B8%E7%94%A8%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%95%B4%E7%90%86/" class="post-title-link" itemprop="url">常用弹出对话框整理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-14 11:47:36" itemprop="dateCreated datePublished" datetime="2020-12-14T11:47:36+08:00">2020-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-30 21:55:59" itemprop="dateModified" datetime="2023-01-30T21:55:59+08:00">2023-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="常用弹出对话框整理" href="/2020/12/14/2021-03-06-%E5%B8%B8%E7%94%A8%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%95%B4%E7%90%86/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::d1f169a7f0737f27bb8c8497d738e9df" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一-代码位置"><a href="#一-代码位置" class="headerlink" title="一.代码位置"></a>一.代码位置</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/itemuse/XTester/tree/master/dialog">XTester-Dialog</a><br>此文是在此基础上做的讲解,用于加深印象</li>
</ul>
<h3 id="二-普通对话框"><a href="#二-普通对话框" class="headerlink" title="二.普通对话框"></a>二.普通对话框</h3><img src="/2020/12/14/2021-03-06-%E5%B8%B8%E7%94%A8%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%95%B4%E7%90%86/1.png" class title="This is an example image">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**普通对话框**/</span><br><span class="line">private void showNormalDialog()&#123;</span><br><span class="line">    final AlertDialog.Builder normalDialog = new AlertDialog.Builder(this);</span><br><span class="line">    normalDialog.setIcon(R.mipmap.tr_step_left_normal);</span><br><span class="line">    normalDialog.setTitle(&quot;DiaLog Title&quot;);</span><br><span class="line">    normalDialog.setMessage(&quot;DiaLog Message&quot;);</span><br><span class="line">    normalDialog.setPositiveButton(&quot;Positive&quot;,</span><br><span class="line">            new DialogInterface.OnClickListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">                    showToast(&quot;Positive&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    normalDialog.setNegativeButton(&quot;Negative&quot;,</span><br><span class="line">            new DialogInterface.OnClickListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">                    showToast(&quot;Negative&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    normalDialog.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="四-普通对话框-增加第三个选择按钮"><a href="#四-普通对话框-增加第三个选择按钮" class="headerlink" title="四.普通对话框 增加第三个选择按钮"></a>四.普通对话框 增加第三个选择按钮</h3><img src="/2020/12/14/2021-03-06-%E5%B8%B8%E7%94%A8%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%95%B4%E7%90%86/2.png" class title="This is an example image">


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/**普通对话框 增加第三个选择按钮**/</span><br><span class="line">private void showMultiBtnDialog()&#123;</span><br><span class="line">    AlertDialog.Builder normalDialog =</span><br><span class="line">            new AlertDialog.Builder(MainActivity.this);</span><br><span class="line">    normalDialog.setIcon(R.mipmap.tr_step_left_normal);</span><br><span class="line">    normalDialog.setTitle(&quot;DiaLog Title&quot;).setMessage(&quot;DiaLog Message&quot;);</span><br><span class="line">    normalDialog.setPositiveButton(&quot;Positive&quot;,</span><br><span class="line">            new DialogInterface.OnClickListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">                    showToast(&quot;Positive&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    normalDialog.setNeutralButton(&quot;Neutral2&quot;,</span><br><span class="line">            new DialogInterface.OnClickListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">                    showToast(&quot;Neutral2&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    normalDialog.setNegativeButton(&quot;Negative&quot;, new DialogInterface.OnClickListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">            showToast(&quot;Negative&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    // 创建实例并显示</span><br><span class="line">    normalDialog.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="五-列表选择对话框"><a href="#五-列表选择对话框" class="headerlink" title="五.列表选择对话框"></a>五.列表选择对话框</h3><img src="/2020/12/14/2021-03-06-%E5%B8%B8%E7%94%A8%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%95%B4%E7%90%86/3.png" class title="This is an example image">


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**列表选择对话框**/</span><br><span class="line">private void showListDialog() &#123;</span><br><span class="line">    final String[] items = &#123; &quot;items1&quot;,&quot;items2&quot;,&quot;items3&quot;,&quot;items4&quot; &#125;;</span><br><span class="line">    AlertDialog.Builder listDialog =</span><br><span class="line">            new AlertDialog.Builder(MainActivity.this);</span><br><span class="line">    listDialog.setTitle(&quot;DiaLog Title&quot;);</span><br><span class="line">    listDialog.setItems(items, new DialogInterface.OnClickListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">            showToast(&quot;点击 &quot;+items[which]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    listDialog.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="六-列表单选对话框"><a href="#六-列表单选对话框" class="headerlink" title="六.列表单选对话框"></a>六.列表单选对话框</h3><img src="/2020/12/14/2021-03-06-%E5%B8%B8%E7%94%A8%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%95%B4%E7%90%86/4.png" class title="This is an example image">


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/**列表单选对话框**/</span><br><span class="line">int mChoice;</span><br><span class="line">private void showSingleChoiceDialog()&#123;</span><br><span class="line">    final String[] items = &#123; &quot;items1&quot;,&quot;items2&quot;,&quot;items3&quot;,&quot;items4&quot; &#125;;</span><br><span class="line">    AlertDialog.Builder singleChoiceDialog =</span><br><span class="line">            new AlertDialog.Builder(MainActivity.this);</span><br><span class="line">    singleChoiceDialog.setTitle(&quot;DiaLog Title&quot;);</span><br><span class="line">    // 第二个参数是默认选项，此处设置为0</span><br><span class="line">    singleChoiceDialog.setSingleChoiceItems(items, mChoice,</span><br><span class="line">            new DialogInterface.OnClickListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">                    mChoice = which;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    singleChoiceDialog.setPositiveButton(&quot;Positive&quot;,</span><br><span class="line">            new DialogInterface.OnClickListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">                    if (mChoice != -1) &#123;</span><br><span class="line">                        showToast(&quot;选择 &quot;+items[mChoice]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    singleChoiceDialog.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="七-列表多选对话框"><a href="#七-列表多选对话框" class="headerlink" title="七.列表多选对话框"></a>七.列表多选对话框</h3><img src="/2020/12/14/2021-03-06-%E5%B8%B8%E7%94%A8%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%95%B4%E7%90%86/5.png" class title="This is an example image">


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/**列表多选对话框**/</span><br><span class="line">ArrayList&lt;String&gt; mChoices = new ArrayList&lt;&gt;();</span><br><span class="line">final boolean initChoiceSets[]=&#123;false,false,false,false&#125;;</span><br><span class="line">private void showMultiChoiceDialog() &#123;</span><br><span class="line">    final String[] items = &#123; &quot;items1&quot;,&quot;items2&quot;,&quot;items3&quot;,&quot;items4&quot; &#125;;</span><br><span class="line">    AlertDialog.Builder multiChoiceDialog = new AlertDialog.Builder(this);</span><br><span class="line">    multiChoiceDialog.setTitle(&quot;DiaLog Title&quot;);</span><br><span class="line">    multiChoiceDialog.setMultiChoiceItems(items, initChoiceSets,</span><br><span class="line">            new DialogInterface.OnMultiChoiceClickListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onClick(DialogInterface dialog, int which,</span><br><span class="line">                                    boolean isChecked) &#123;</span><br><span class="line">                    initChoiceSets[which] = isChecked;</span><br><span class="line">                    if (isChecked) &#123;</span><br><span class="line">                        mChoices.add(items[which]);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        String  s  = items[which];</span><br><span class="line">                        Log.i(&quot;md&quot;,&quot; findInterIdex(mChoices,s):  &quot;+findInterIdex(mChoices,s));</span><br><span class="line">                        mChoices.remove(findInterIdex(mChoices,s));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    multiChoiceDialog.setPositiveButton(&quot;Positive&quot;,</span><br><span class="line">            new DialogInterface.OnClickListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">                    int size = mChoices.size();</span><br><span class="line">                    String str = &quot;&quot;;</span><br><span class="line">                    for (int i = 0; i &lt; size; i++) &#123;</span><br><span class="line">                        str += mChoices.get(i) ;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    showToast(&quot;选择了 &quot;+str);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    multiChoiceDialog.show();</span><br><span class="line">&#125;</span><br><span class="line">public static int findInterIdex(List&lt;String&gt; nums, String target)&#123;</span><br><span class="line">    return Collections.binarySearch(nums,target);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="八-进度弹出框"><a href="#八-进度弹出框" class="headerlink" title="八.进度弹出框"></a>八.进度弹出框</h3><img src="/2020/12/14/2021-03-06-%E5%B8%B8%E7%94%A8%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%95%B4%E7%90%86/6.png" class title="This is an example image">


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/**进度弹出框**/</span><br><span class="line">private void showProgressDialog() &#123;</span><br><span class="line">    final int MAX_PROGRESS = 100;</span><br><span class="line">    final ProgressDialog progressDialog =</span><br><span class="line">            new ProgressDialog(MainActivity.this);</span><br><span class="line">    progressDialog.setProgress(0);</span><br><span class="line">    progressDialog.setTitle(&quot;ProgressDialog Title&quot;);</span><br><span class="line">    progressDialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);</span><br><span class="line">    progressDialog.setMax(MAX_PROGRESS);</span><br><span class="line">    progressDialog.show();</span><br><span class="line">    /* 模拟进度增加的过程</span><br><span class="line">     * 新开一个线程，每个100ms，进度增加1</span><br><span class="line">     */</span><br><span class="line">    new Thread(new Runnable() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            int progress= 0;</span><br><span class="line">            while (progress &lt; MAX_PROGRESS)&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(100);</span><br><span class="line">                    progress++;</span><br><span class="line">                    progressDialog.setProgress(progress);</span><br><span class="line">                &#125; catch (InterruptedException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            // 进度达到最大值后，窗口消失</span><br><span class="line">            progressDialog.cancel();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="九-输入对话框"><a href="#九-输入对话框" class="headerlink" title="九.输入对话框"></a>九.输入对话框</h3><img src="/2020/12/14/2021-03-06-%E5%B8%B8%E7%94%A8%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%95%B4%E7%90%86/7.png" class title="This is an example image">


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**输入对话框**/</span><br><span class="line">private void showInputDialog() &#123;</span><br><span class="line">    final EditText editText = new EditText(MainActivity.this);</span><br><span class="line">    AlertDialog.Builder inputDialog =</span><br><span class="line">            new AlertDialog.Builder(MainActivity.this);</span><br><span class="line">    inputDialog.setTitle(&quot;AlertDialog Title&quot;).setView(editText);</span><br><span class="line">    inputDialog.setPositiveButton(&quot;Positive&quot;,</span><br><span class="line">            new DialogInterface.OnClickListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">                    showToast(&quot;输入了 &quot;+editText.getText().toString());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="十-自定义输入对话框"><a href="#十-自定义输入对话框" class="headerlink" title="十.自定义输入对话框"></a>十.自定义输入对话框</h3><img src="/2020/12/14/2021-03-06-%E5%B8%B8%E7%94%A8%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%95%B4%E7%90%86/8.png" class title="This is an example image">


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/**自定义输入对话框</span><br><span class="line">private void showCustomizeDialog() &#123;</span><br><span class="line">    AlertDialog.Builder customizeDialog =</span><br><span class="line">            new AlertDialog.Builder(MainActivity.this);</span><br><span class="line">    final View dialogView = LayoutInflater.from(MainActivity.this)</span><br><span class="line">            .inflate(R.layout.dialog_customize,null);</span><br><span class="line">    customizeDialog.setTitle(&quot;自定义AlertDialog Title&quot;);</span><br><span class="line">    customizeDialog.setView(dialogView);</span><br><span class="line">    dialogView.findViewById(R.id.btn).setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onClick(View view) &#123;</span><br><span class="line">            showToast(&quot;输入了 &quot;+((EditText)dialogView.findViewById(R.id.edit_text)).getText().toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    customizeDialog.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 自定义View --&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:gravity=&quot;bottom&quot;</span><br><span class="line">    &gt;</span><br><span class="line"></span><br><span class="line">    &lt;EditText</span><br><span class="line">        android:id=&quot;@+id/edit_text&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_weight=&quot;1&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id=&quot;@+id/btn&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:src=&quot;@mipmap/tr_step_left_normal&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<h3 id="十一：二级对话选择框"><a href="#十一：二级对话选择框" class="headerlink" title="十一：二级对话选择框"></a>十一：二级对话选择框</h3><p><a target="_blank" rel="noopener" href="https://freedomyouth.gitee.io/2021/02/27/%E4%BA%8C%E7%BA%A7%E9%80%89%E6%8B%A9%E6%A1%86%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/">二级选择框使用笔记</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="项勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自由侠">
      <meta itemprop="description" content="万里苍穹，星辰大海">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 自由侠">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">Fragment基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-29 09:29:19" itemprop="dateCreated datePublished" datetime="2020-05-29T09:29:19+08:00">2020-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-30 22:06:23" itemprop="dateModified" datetime="2023-01-30T22:06:23+08:00">2023-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Fragment基础" href="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::7bebd2d5280a9343077c34cb2653be0c" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一-来源："><a href="#一-来源：" class="headerlink" title="一.来源："></a>一.来源：</h3><blockquote>
<blockquote>
<p>摘自网络</p>
</blockquote>
</blockquote>
<h3 id="二-Fragment初探："><a href="#二-Fragment初探：" class="headerlink" title="二.Fragment初探："></a>二.Fragment初探：</h3><p>Fragment是activity的界面中的一部分或一种行为。你可以把多个Fragment们组合到一个activity中来创建一个多面界面，并且你可以在多个activity中重用一个Fragment。你可以把Fragment认为模块化的一段activity，它具有自己的生命周期，接收它自己的事件，并可以在activity运行时被添加或删除。</p>
<p>Fragment不能独立存在，它必须嵌入到activity中，而且Fragment的生命周期直接受所在的activity的影响。例如：当activity暂停时，它拥有的所有的Fragment们都暂停了，当activity销毁时，它拥有的所有Fragment们都被销毁。然而，当activity运行时（在onResume()之后，onPause()之前），你可以单独地操作每个Fragment，比如添加或删除它们。当你在执行上述针对Fragment的事务时，你可以将事务添加到一个栈中，这个栈被activity管理，栈中的每一条都是一个Fragment的一次事务。有了这个栈，就可以反向执行Fragment的事务，这样就可以在Fragment级支持“返回”键（向后导航）。</p>
<p>当向activity中添加一个Fragment时，它须置于ViewGroup控件中，并且需定义Fragment自己的界面。你可以在layoutxml文件中声明Fragment，元素为：<fragment>；也可以在代码中创建Fragment，然后把它加入到ViewGroup控件中。然而，Fragment不一定非要放在activity的界面中，它可以隐藏在后台为actvitiy工作。</fragment></p>
<p>设计的哲学：</p>
<p>为了让界面可以在平板上更好地展示，Android在3.0版本引入了Fragment(碎片)功能，通过官方文档中的这张图片可以很明显地看到Fragment的好处：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img1.png" class title="This is an example image">

<p>注：左边为平板，右边为手持设备。</p>
<h3 id="三-Fragment的生命周期："><a href="#三-Fragment的生命周期：" class="headerlink" title="三.Fragment的生命周期："></a>三.Fragment的生命周期：</h3><p>因为Fragment必须嵌入在Acitivity中使用，所以Fragment的生命周期和它所在的Activity是密切相关的。</p>
<p>如果Activity是暂停状态，其中所有的Fragment都是暂停状态；如果Activity是stopped状态，这个Activity中所有的Fragment都不能被启动；如果Activity被销毁，那么它其中的所有Fragment都会被销毁。</p>
<p>但是，当Activity在活动状态，可以独立控制Fragment的状态，比如加上或者移除Fragment。</p>
<p>当这样进行fragment transaction（转换）的时候，可以把fragment放入Activity的back stack中，这样用户就可以进行返回操作。</p>
<p>使用Fragment时，需要继承Fragment或者Fragment的子类（DialogFragment, ListFragment, PreferenceFragment, WebViewFragment），所以Fragment的代码看起来和Activity的类似。</p>
<p>每当创建一个Fragment时，首先添加以下三个回调方法：</p>
<p>onCreate()：系统在创建Fragment的时候调用这个方法，这里应该初始化相关的组件，一些即便是被暂停或者被停止时依然需要保留的东西。<br>onCreateView()：当第一次绘制Fragment的UI时系统调用这个方法，该方法将返回一个View，如果Fragment不提供UI也可以返回null。注意，如果继承自ListFragment，onCreateView()默认的实现会返回一个ListView，所以不用自己实现。<br>onPause()：当用户离开Fragment时第一个调用这个方法，需要提交一些变化，因为用户很可能不再返回来。<br>将Fragment加载到Activity当中有两种方式：</p>
<p>方式一：添加Fragment到Activity的布局文件当中<br>方式二：在Activity的代码中动态添加Fragment<br>第一种方式虽然简单但灵活性不够。添加Fragment到Activity的布局文件当中,就等同于将Fragment及其视图与activity的视图绑定在一起，且在activity的生命周期过程中，无法切换fragment视图。</p>
<p>第二种方式比较复杂，但也是唯一一种可以在运行时控制fragment的方式（加载、移除、替换）。</p>
<p>下面将分别介绍一下。</p>
<p>　　</p>
<h3 id="四-在Activity的布局文件中添加Fragment：（不推荐）"><a href="#四-在Activity的布局文件中添加Fragment：（不推荐）" class="headerlink" title="四.在Activity的布局文件中添加Fragment：（不推荐）"></a>四.在Activity的布局文件中添加Fragment：（不推荐）</h3><p>平板的模拟器参数如下：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img2.png" class title="This is an example image">


<p>然后新建一个工程文件。然后继续如下步骤：</p>
<p>（1）新建文件fragment_hello.xml和HelloFragment.java：</p>
<p>fragment_hello.xml代码如下：（即Fragment的布局文件）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line">    </span><br><span class="line">    &lt;EditText </span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:hint=&quot;请输入内容&quot;/&gt;</span><br><span class="line">    &lt;RatingBar</span><br><span class="line">        android:id=&quot;@+id/ratingBar1&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot; /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>HelloFragment.java代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package com.example.m01_fragment01;</span><br><span class="line"></span><br><span class="line">import android.app.Fragment;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.view.LayoutInflater;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line">public class HelloFragment extends Fragment &#123;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">            Bundle savedInstanceState) &#123;</span><br><span class="line">        View view = inflater.inflate(R.layout.fragment_hello, null);  // View android.view.LayoutInflater.inflate(int resource, ViewGroup root) </span><br><span class="line">        return view;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void onPause() &#123;</span><br><span class="line">        super.onPause();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重点在于第19和20行，通过inflate()方法将自定义的fragment的布局加载进来。</p>
<p>19行代码中，第二个参数中，如果布局没有根，那就用null。</p>
<p>注：上方代码中，因为我们的程序是面对Android 4.0以上版本的，所以导入Fragment的包时，选择第一个：android.app.Fragment</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img3.png" class title="This is an example image">

<p>（2）将Fragment添加到Activity的布局中：</p>
<p>修改activity_main.xml的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;.MainActivity&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;fragment</span><br><span class="line">        android:id=&quot;@+id/fragment_hello&quot;</span><br><span class="line">        android:name=&quot;com.example.m01_fragment02.HelloFragment&quot;</span><br><span class="line">       android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot; /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>08行和09行是关键。其中android:name属性填上你自己创建的fragment的完整类名。如下图：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img4.png" class title="This is an example image">

<p>当系统创建这个Activity的布局文件时，系统会实例化每一个fragment，并且调用它们的onCreateView()方法，来获得相应fragment的布局，并将返回值插入fragment标签所在的地方。</p>
<p>运行之后，效果如下：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img5.png" class title="This is an example image">

<p>实际上，这种方式在开发中并不推荐，我们来介绍另外一种方法。</p>
<h3 id="五-在activity代码中添加fragment："><a href="#五-在activity代码中添加fragment：" class="headerlink" title="五.在activity代码中添加fragment："></a>五.在activity代码中添加fragment：</h3><p>【实例】点击左侧fragment中的按钮，弹出右侧的fragment。新建一个工程文件，然后步骤如下：</p>
<ol>
<li><p>将activity_main的布局分为两部分：左边占1&#x2F;4，右边占3&#x2F;4。修改activity_main.xml的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;.MainActivity&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:id=&quot;@+id/left&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot;</span><br><span class="line">        android:layout_weight=&quot;1&quot;</span><br><span class="line">        android:background=&quot;#00BFFF&quot; &gt;</span><br><span class="line">        </span><br><span class="line">        &lt;Button </span><br><span class="line">            android:id=&quot;@+id/button1&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;            </span><br><span class="line">            android:text=&quot;显示&quot;/&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">         android:id=&quot;@+id/right&quot;       </span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:layout_weight=&quot;3&quot;</span><br><span class="line">        android:background=&quot;#00FFFF&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>上方代码中，一个LinearLayout代表一个Fragment的容器，记得要给每个fragment加一个容器的id。上方代码的布局效果如下：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img6.png" class title="This is an example image">
<p>既然两个fragment的空间都分配好了，接下来右边的Fragment写出来。</p>
</li>
<li><p>新建文件fragment_right.xml和RightFragment.java：<br>fragment_right.xml代码如下：（添加一个文本和按钮）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/textView1&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;新闻内容&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/button2&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Button&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>RightFragment.java代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.example.m01_fragment03;</span><br><span class="line"></span><br><span class="line">import android.app.Fragment;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.view.LayoutInflater;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line">public class RightFragment extends Fragment &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">            Bundle savedInstanceState) &#123;</span><br><span class="line">        View view = inflater.inflate(R.layout.fragment_right, null);</span><br><span class="line">        return view;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void onPause() &#123;</span><br><span class="line">        super.onPause();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>紧接着，我们修改上方onCreateView()方法中的代码，实现点击按钮，能够弹出吐司：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">            Bundle savedInstanceState) &#123;</span><br><span class="line">        View view = inflater.inflate(R.layout.fragment_right, null);</span><br><span class="line">        Button button = (Button)view.findViewById(R.id.button2);</span><br><span class="line">        button.setOnClickListener(new OnClickListener() &#123;            </span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Toast.makeText(getActivity(), &quot;我是fragment&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return view;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>第04行代码：有一个单词view不要忘了。<br>第08行代码：第一个参数一定是getActivity，以此来获得父类的Activity</p>
</li>
<li><p>在activity代码中添加fragment：<br>点击MainActivity中左侧的按钮，弹出右侧的Fragment，<br>MainActivity.java的监听器部分的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> button.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">     </span><br><span class="line">     @Override</span><br><span class="line">     public void onClick(View v) &#123;</span><br><span class="line">  </span><br><span class="line">         //步骤一：添加一个FragmentTransaction的实例</span><br><span class="line">         FragmentManager fragmentManager =getFragmentManager();</span><br><span class="line">        FragmentTransaction transaction = fragmentManager.beginTransaction();</span><br><span class="line">  </span><br><span class="line">        //步骤二：用add()方法加上Fragment的对象rightFragment </span><br><span class="line">        RightFragment rightFragment = new RightFragment();</span><br><span class="line">        transaction.add(R.id.right, rightFragment);</span><br><span class="line"> </span><br><span class="line">        //步骤三：调用commit()方法使得FragmentTransaction实例的改变生效</span><br><span class="line">        transaction.commit();                </span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>记住上面的三个步骤。<br>第12行代码是整个程序的核心。add()方法里的第一个参数是容器视图资源ID，而不是layout。容器视图资源ID有两个作用：<br>告知FragmentManager，fragment视图应该出现在activity视图的什么地方<br>是FragmentManager队列中fragment的唯一标识符<br>运行后，效果如下：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img7.png" class title="This is an example image">
<p>点击左侧的按钮后，出现右侧的界面。点击右侧的按钮，弹出吐司。效果如下：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img8.png" class title="This is an example image">
<p>当然，这个代码还不够成熟，因为还涉及到了生命周期没有处理。我们将在下一章节中进行讲解。</p>
</li>
</ol>
<h3 id="六-Fragment的生命周期初探："><a href="#六-Fragment的生命周期初探：" class="headerlink" title="六.Fragment的生命周期初探："></a>六.Fragment的生命周期初探：</h3><p>因为Fragment必须嵌入在Acitivity中使用，所以Fragment的生命周期和它所在的Activity是密切相关的。</p>
<p>如果Activity是暂停状态，其中所有的Fragment都是暂停状态；如果Activity是stopped状态，这个Activity中所有的Fragment都不能被启动；如果Activity被销毁，那么它其中的所有Fragment都会被销毁。</p>
<p>但是，当Activity在活动状态，可以独立控制Fragment的状态，比如加上或者移除Fragment。</p>
<p>当这样进行fragment transaction（转换）的时候，可以把fragment放入Activity的back stack中，这样用户就可以进行返回操作。</p>
<p>使用Fragment时，需要继承Fragment或者Fragment的子类（DialogFragment, ListFragment, PreferenceFragment, WebViewFragment），所以Fragment的代码看起来和Activity的类似。</p>
<p>每当创建一个Fragment时，首先添加以下三个回调方法：</p>
<p>onCreate()：系统在创建Fragment的时候调用这个方法，这里应该初始化相关的组件，一些即便是被暂停或者被停止时依然需要保留的东西。<br>onCreateView()：当第一次绘制Fragment的UI时系统调用这个方法，该方法将返回一个View，如果Fragment不提供UI也可以返回null。注意，如果继承自ListFragment，onCreateView()默认的实现会返回一个ListView，所以不用自己实现。<br>onPause()：当用户离开Fragment时第一个调用这个方法，需要提交一些变化，因为用户很可能不再返回来。<br>将Fragment加载到Activity当中有两种方式：</p>
<p>方式一：添加Fragment到Activity的布局文件当中<br>方式二：在Activity的代码中动态添加Fragment（荐）<br>第一种方式虽然简单但灵活性不够。添加Fragment到Activity的布局文件当中,就等同于将Fragment及其视图与activity的视图绑定在一起，且在activity的生命周期过程中，无法切换fragment视图。</p>
<p>第二种方式比较复杂，但也是唯一一种可以在运行时控制fragment的方式（加载、移除、替换）。</p>
<h3 id="七-Fragment的生命周期详解："><a href="#七-Fragment的生命周期详解：" class="headerlink" title="七.Fragment的生命周期详解："></a>七.Fragment的生命周期详解：</h3><p>先来看一下官方文档的图片吧：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img9.png" class title="This is an example image">


<p>我们再把Activity的生命周期和Fragment的生命周期对比一下，就清楚很多了：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img10.png" class title="This is an example image">


<p>我们还是在实例中来看一下Fragment的生命周期吧。</p>
<p>【实例】在MainActivity中加载一个Fragment：（完整版代码如下）</p>
<p>我们所创建的Fragment的布局文件fragment01.xml的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;RatingBar</span><br><span class="line">        android:id=&quot;@+id/ratingBar1&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/button1&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Button&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>MyFragment.java代码如下：（注意生命周期中每个方法的作用）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">  package com.example.m01_fragmentlifecycle;</span><br><span class="line">  </span><br><span class="line">  import android.app.Activity;</span><br><span class="line">  import android.app.Fragment;</span><br><span class="line">  import android.os.Bundle;</span><br><span class="line">  import android.util.Log;</span><br><span class="line">  import android.view.LayoutInflater;</span><br><span class="line">  import android.view.View;</span><br><span class="line">  import android.view.ViewGroup;</span><br><span class="line"> </span><br><span class="line"> public class MyFragment extends Fragment &#123;</span><br><span class="line">     private final String TAG = &quot;MyFragment&quot;;</span><br><span class="line">     </span><br><span class="line">     //获得activity的传递的值</span><br><span class="line">     @Override</span><br><span class="line">     public void onAttach(Activity activity) &#123;</span><br><span class="line">         // TODO Auto-generated method stub</span><br><span class="line">         super.onAttach(activity);</span><br><span class="line">         Log.i(TAG, &quot;--MyFragment-&gt;&gt;onAttach&quot;);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     //实例化成员变量</span><br><span class="line">     @Override</span><br><span class="line">     public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">         // TODO Auto-generated method stub</span><br><span class="line">         super.onCreate(savedInstanceState);</span><br><span class="line">         Log.i(TAG, &quot;--MyFragment-&gt;&gt;onCreate&quot;);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     //给当前的fragment绘制UI布局，可以使用线程更新UI</span><br><span class="line">     @Override</span><br><span class="line">     public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">             Bundle savedInstanceState) &#123;</span><br><span class="line">         Log.i(TAG, &quot;--MyFragment-&gt;&gt;onCreateView&quot;);</span><br><span class="line">         View view = inflater.inflate(R.layout.fragment01, null);</span><br><span class="line">         // TODO Auto-generated method stub</span><br><span class="line">         return view;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     //表示activity执行oncreate方法完成了的时候会调用此方法</span><br><span class="line">     @Override</span><br><span class="line">     public void onActivityCreated(Bundle savedInstanceState) &#123;</span><br><span class="line">         // TODO Auto-generated method stub</span><br><span class="line">         super.onActivityCreated(savedInstanceState);</span><br><span class="line">         Log.i(TAG, &quot;--MyFragment-&gt;&gt;onActivityCreated&quot;);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     //和activity一致</span><br><span class="line">     @Override</span><br><span class="line">     public void onStart() &#123;</span><br><span class="line">         // TODO Auto-generated method stub</span><br><span class="line">         super.onStart();</span><br><span class="line">         Log.i(TAG, &quot;--MyFragment-&gt;&gt;onStart&quot;);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     //和activity一致</span><br><span class="line">     @Override</span><br><span class="line">     public void onResume() &#123;</span><br><span class="line">         // TODO Auto-generated method stub</span><br><span class="line">         super.onResume();</span><br><span class="line">         Log.i(TAG, &quot;--MyFragment-&gt;&gt;onResume&quot;);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     //和activity一致</span><br><span class="line">     @Override</span><br><span class="line">     public void onPause() &#123;</span><br><span class="line">         // TODO Auto-generated method stub</span><br><span class="line">         super.onPause();</span><br><span class="line">         Log.i(TAG, &quot;--MyFragment-&gt;&gt;onPause&quot;);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     //和activity一致</span><br><span class="line">     @Override</span><br><span class="line">     public void onStop() &#123;</span><br><span class="line">         // TODO Auto-generated method stub</span><br><span class="line">         super.onStop();</span><br><span class="line">         Log.i(TAG, &quot;--MyFragment-&gt;&gt;onStop&quot;);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     //表示fragment销毁相关联的UI布局</span><br><span class="line">     @Override</span><br><span class="line">     public void onDestroyView() &#123;</span><br><span class="line">         // TODO Auto-generated method stub</span><br><span class="line">         super.onDestroyView();</span><br><span class="line">        Log.i(TAG, &quot;--MyFragment-&gt;&gt;onDestroyView&quot;);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     //销毁fragment对象</span><br><span class="line">     @Override</span><br><span class="line">     public void onDestroy() &#123;</span><br><span class="line">         // TODO Auto-generated method stub</span><br><span class="line">         super.onDestroy();</span><br><span class="line">         Log.i(TAG, &quot;--MyFragment-&gt;&gt;onDestroy&quot;);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     //脱离activity</span><br><span class="line">     @Override</span><br><span class="line">     public void onDetach() &#123;</span><br><span class="line">         // TODO Auto-generated method stub</span><br><span class="line">        super.onDetach();</span><br><span class="line">        Log.i(TAG, &quot;--MyFragment-&gt;&gt;onDetach&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>activity_main.xml的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot;</span><br><span class="line">    tools:context=&quot;.MainActivity&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:id=&quot;@+id/line&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>MainActivity.java的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">package com.example.m01_fragmentlifecycle;</span><br><span class="line"></span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.app.Activity;</span><br><span class="line">import android.app.FragmentManager;</span><br><span class="line">import android.app.FragmentTransaction;</span><br><span class="line">import android.util.Log;</span><br><span class="line">import android.view.Menu;</span><br><span class="line"></span><br><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line">    private final String TAG = &quot;MainActivity&quot;;</span><br><span class="line">    private FragmentManager manager;</span><br><span class="line">    private FragmentTransaction transaction;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        manager = getFragmentManager();</span><br><span class="line">        transaction = manager.beginTransaction();</span><br><span class="line">        MyFragment fragment = new MyFragment();</span><br><span class="line">        transaction.add(R.id.line, fragment);</span><br><span class="line">        transaction.commit();</span><br><span class="line">        Log.i(TAG, &quot;--MainActivity-&gt;&gt;onCreate&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onStart() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onStart();</span><br><span class="line">        Log.i(TAG, &quot;--MainActivity-&gt;&gt;onStart&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onResume() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onResume();</span><br><span class="line">        Log.i(TAG, &quot;--MainActivity-&gt;&gt;onResume&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onPause() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onPause();</span><br><span class="line">        Log.i(TAG, &quot;--MainActivity-&gt;&gt;onPause&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onStop() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onStop();</span><br><span class="line">        Log.i(TAG, &quot;--MainActivity-&gt;&gt;onStop&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onRestart() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onRestart();</span><br><span class="line">        Log.i(TAG, &quot;--MainActivity-&gt;&gt;onRestart&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onDestroy() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onDestroy();</span><br><span class="line">        Log.i(TAG, &quot;--MainActivity-&gt;&gt;onDestroy&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onCreateOptionsMenu(Menu menu) &#123;</span><br><span class="line">        // Inflate the menu; this adds items to the action bar if it is present.</span><br><span class="line">        getMenuInflater().inflate(R.menu.main, menu);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，上面的代码在每个生命周期的方法里都打印了日志，然后我们来运行一下程序，可以看到打印日志如下：</p>
<p>初次加载：（分成两部分来看）</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img11.png" class title="This is an example image">
<p>点击一下home键（或接入电话），打印日志如下：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img12.png" class title="This is an example image">


<p>重新进入进入程序（或电话结束），打印日志如下：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img13.png" class title="This is an example image">

<p>点击back键退出程序，打印日志如下：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img14.png" class title="This is an example image">

<p>通过上面的日志，我们能够看出，Fragment和Activity的生命周期太相似了。只是有几个Activity中没有的新方法，需要重点介绍一下：</p>
<p>onAttach方法：Fragment和Activity建立关联的时候调用（获得activity的传递的值）<br>onCreateView方法：为Fragment创建视图（加载布局）时调用（给当前的fragment绘制UI布局，可以使用线程更新UI）<br>onActivityCreated方法：当Activity中的onCreate方法执行完后调用（表示activity执行oncreate方法完成了的时候会调用此方法）<br>onDestroyView方法：Fragment中的布局被移除时调用（表示fragment销毁相关联的UI布局）<br>onDetach方法：Fragment和Activity解除关联的时候调用（脱离activity）</p>
<h3 id="八-Fragment返回栈的管理："><a href="#八-Fragment返回栈的管理：" class="headerlink" title="八.Fragment返回栈的管理："></a>八.Fragment返回栈的管理：</h3><p>将Fragment添加到返回栈中：</p>
<p>假设现在我们有两个Fragment：Fragment01和Fragment02，我们现在从Fragment01的界面跳到Fragment02，然后按Back键，发现程序是直接退出了，而不是返回到Fragment01。如果现在想实现以下功能：从Fragment01的界面跳到Fragment02，然后按Back键，会返回到Fragment01。这个功能该怎么实现呢？这其实就利用到了返回栈的知识。</p>
<p>其实很简单，FragmentTransaction中提供了一个addToBackStack()方法，可以将一个事务添加到返回栈中。</p>
<p>我们先回顾一下之前动态加载Fragment的代码，然后在此基础之上，增加一行代码就可以将Fragment添加到返回栈中：（即第07行代码）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//步骤一：添加一个FragmentTransaction的实例</span><br><span class="line">FragmentManager fragmentManager =getFragmentManager();</span><br><span class="line">FragmentTransaction transaction = fragmentManager.beginTransaction();</span><br><span class="line">//步骤二：用add()方法加上Fragment的对象</span><br><span class="line">RightFragment rightFragment = new RightFragment();</span><br><span class="line">transaction.add(R.id.right, rightFragment);</span><br><span class="line">transaction.addToBackStack(null);</span><br><span class="line">//步骤三：调用commit()方法使得FragmentTransaction实例的改变生效</span><br><span class="line">transaction.commit(); </span><br></pre></td></tr></table></figure>
<p>第07行代码：我们在事务提交之前调用了FragmentTransaction的addToBackStack()方法，它可以接受一个名字用于描述返回栈的状态，，一般传入null即可。</p>
<p>【实例】现在通过代码来实现以下界面（下面的图片为程序运行时加载的首页），并且把每一个Fragment都加入到返回栈当中去，然后观察其生命周期的变化。完整代码如下：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img15.png" class title="This is an example image">

<p>首先新建工程文件m01_Fragment04，然后开始我们的代码之旅：</p>
<p>我们先把右侧的四个Fragment建起来吧：</p>
<p>Fragment01.java主要部分的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.example.m01_fragment04;</span><br><span class="line"></span><br><span class="line">import android.app.Fragment;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.view.LayoutInflater;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line">public class Fragment01 extends Fragment &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">            Bundle savedInstanceState) &#123;</span><br><span class="line">        View view = inflater.inflate(R.layout.f1, null);</span><br><span class="line">        return view;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void onPause() &#123;</span><br><span class="line">        super.onPause();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为避免啰嗦，这里就不把Fragment01生命周期中的其他函数罗列出来了，我们只要知道在实际代码中这些函数都是加了的。</p>
<p>Fragment01的布局文件f1.xml的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/textView1&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;加载图片&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>然后依次新建出Fragment02、Fragment03、Fragment04的java代码和布局文件。</p>
<p>MainActivity的布局文件activity_main.xml代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;.MainActivity&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:id=&quot;@+id/left&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:background=&quot;#CCCCCC&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/button1&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;加载图片&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/button2&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;海报管理&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/button3&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;照片管理&quot; /&gt;</span><br><span class="line">   </span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/button4&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;新闻管理&quot; /&gt;        </span><br><span class="line">        </span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:id=&quot;@+id/right&quot;       </span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:layout_weight=&quot;1&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>其中，第一个LinearLayout表示左侧的按钮，第二个LinearLayout留给右边的Fragment。</p>
<p>MainActivity.java的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">package com.example.m01_fragment04;</span><br><span class="line"></span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.app.Activity;</span><br><span class="line">import android.app.FragmentManager;</span><br><span class="line">import android.app.FragmentTransaction;</span><br><span class="line">import android.view.Menu;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.View.OnClickListener;</span><br><span class="line">import android.widget.Button;</span><br><span class="line"></span><br><span class="line">public class MainActivity extends Activity  implements OnClickListener&#123;</span><br><span class="line"></span><br><span class="line">    private FragmentManager manager;</span><br><span class="line">    private FragmentTransaction transaction;</span><br><span class="line">    private Button button1,button2,button3,button4;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    manager = getFragmentManager();</span><br><span class="line">        button1 = (Button)this.findViewById(R.id.button1);</span><br><span class="line">        button1.setOnClickListener(this);</span><br><span class="line">        button2 = (Button)this.findViewById(R.id.button2);</span><br><span class="line">        button2.setOnClickListener(this);</span><br><span class="line">        button3 = (Button)this.findViewById(R.id.button3);</span><br><span class="line">        button3.setOnClickListener(this);</span><br><span class="line">        button4 = (Button)this.findViewById(R.id.button4);</span><br><span class="line">        button4.setOnClickListener(this);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onCreateOptionsMenu(Menu menu) &#123;</span><br><span class="line">        // Inflate the menu; this adds items to the action bar if it is present.</span><br><span class="line">        getMenuInflater().inflate(R.menu.main, menu);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //通过点击不同的按钮，跳转到不同的Fragment</span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        transaction = manager.beginTransaction();</span><br><span class="line">        switch (v.getId()) &#123;</span><br><span class="line">        case R.id.button1:</span><br><span class="line">            Fragment01 fragment01 = new Fragment01();</span><br><span class="line">            transaction.replace(R.id.right, fragment01, &quot;fragment01&quot;);</span><br><span class="line">            transaction.addToBackStack(&quot;fragment01&quot;);// 添加到Activity管理的回退栈中。</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        case R.id.button2:</span><br><span class="line">            Fragment02 fragment02 = new Fragment02();</span><br><span class="line">            transaction.replace(R.id.right, fragment02, &quot;fragment02&quot;);</span><br><span class="line">            transaction.addToBackStack(&quot;fragment02&quot;);// 添加到Activity管理的回退栈中。</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        case R.id.button3:</span><br><span class="line">            Fragment03 fragment03 = new Fragment03();</span><br><span class="line">            transaction.replace(R.id.right, fragment03, &quot;fragment03&quot;);</span><br><span class="line">            transaction.addToBackStack(&quot;fragment03&quot;);// 添加到Activity管理的回退栈中。</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        case R.id.button4:</span><br><span class="line">            Fragment04 fragment04 = new Fragment04();</span><br><span class="line">            transaction.replace(R.id.right, fragment04, &quot;fragment04&quot;);</span><br><span class="line">            transaction.addToBackStack(&quot;fragment04&quot;);// 添加到Activity管理的回退栈中。</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上当代码中，通过点击不同的按钮，就能跳到对应的Fragment，而这四个Fragment都已经加入到了返回栈当中。运行程序之后，也是这样的。</p>
<p>注意第46行和第72行，transaction &#x3D; manager.beginTransaction()意味着开始，transaction.commit()意味着结束。</p>
<p>我们就其中的fragment01和fragment02来讨论一下他们的生命周期的变化：</p>
<p>运行程序后，界面如下，没有任何fragment被加载：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img16.png" class title="This is an example image">

<p>点击左侧第一个按钮，加载fragment01：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img17.png" class title="This is an example image">

<p>点击左侧第二个按钮，加载fragment02（此时fragment01被替换，并被压到了栈当中）：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img18.png" class title="This is an example image">

<p>注：如果fragment01在替换的时候没有被压到栈中，那就会被销毁，在执行完onDestroyView()方法后，会继续执行onDestroy()和onDetach()方法。</p>
<p>按Back键，fragment01重新返回到屏幕：（fragment02被销毁）</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img19.png" class title="This is an example image">

<p>再按Back键，fragment01被销毁：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img20.png" class title="This is an example image">

<p> 注：Fragment的返回栈由Activity管理；而Activity的返回栈由系统管理。</p>
<h3 id="九-接口回调的简单引入："><a href="#九-接口回调的简单引入：" class="headerlink" title="九.接口回调的简单引入："></a>九.接口回调的简单引入：</h3><p>我们先来看一个简单的接口回调的例子：</p>
<p>新建一个Java工程，然后新建一个包。然后新建一个A.java文件：</p>
<p>A.java代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.cn.callback;</span><br><span class="line"></span><br><span class="line">public class A &#123;</span><br><span class="line">    public A() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //下载图片的操作</span><br><span class="line">    public void loadImage(String image_path,final CallBack callBack) &#123;</span><br><span class="line">        new Thread(new Runnable()&#123;</span><br><span class="line"></span><br><span class="line">            public void run() &#123;</span><br><span class="line">                // TODO Auto-generated method stub</span><br><span class="line">                String msg = &quot;Hello world&quot;;</span><br><span class="line">                callBack.getResult(msg);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public interface CallBack &#123;</span><br><span class="line">        public void getResult(String result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第21至23行就是回调方法。</p>
<p>新建B.java，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.cn.callback;</span><br><span class="line"></span><br><span class="line">import com.cn.callback.A.CallBack;</span><br><span class="line"></span><br><span class="line">public class B &#123;</span><br><span class="line">    public B()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String args[]) &#123;</span><br><span class="line">        A a = new A();</span><br><span class="line">        a.loadImage(&quot;http://www.baidu.com/a.gif&quot;, new CallBack() &#123;</span><br><span class="line">            public void getResult(String result) &#123;</span><br><span class="line">                // TODO Auto-generated method stub</span><br><span class="line">                System.out.println(result);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后程序运行的结果如下：</p>
<p>关于接口回调，有一个博客，不过现在还不能完全理解，附上链接：</p>
<p>一个经典例子让你彻彻底底理解java回调机制：<a target="_blank" rel="noopener" href="http://blog.csdn.net/xiaanming/article/details/8703708">http://blog.csdn.net/xiaanming/article/details/8703708</a></p>
<h3 id="十-Fragment和Activity的交互："><a href="#十-Fragment和Activity的交互：" class="headerlink" title="十.Fragment和Activity的交互："></a>十.Fragment和Activity的交互：</h3><ol>
<li><p>在Fragment中调用Activity中的方法：<br>Fragment可以通过getActivity()方法来获得Activity的实例，然后就可以调用一些例如findViewById()之类的方法。例如：<br>View listView &#x3D; getActivity().findViewById(R.id.list);<br>但是注意调用getActivity()时，fragment必须和activity关联（attached to an activity），否则将会返回一个null。<br>另外，当碎片中需要使用Context对象时，也可以使用getActivity()方法，因此获取到的活动本身就是一个Context对象。<br>【实例】在Activity的EditText中输入一段文本，这个时候，点击Fragment中的按钮，让它弹出吐司，显示出对应的文本。<br>其实就是让Activity中的文本显示在Fragment中，Fragment的核心代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">            Bundle savedInstanceState) &#123;</span><br><span class="line">        View view = inflater.inflate(R.layout.fragment_left, null);</span><br><span class="line">        button = (Button) view.findViewById(R.id.button1);</span><br><span class="line">        button.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                // TODO Auto-generated method stub</span><br><span class="line">                EditText editText = (EditText) getActivity().findViewById(R.id.editText);</span><br><span class="line">                Toast.makeText(getActivity(), editText.getText().toString(), 1).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        return view;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>第09行代码是核心，通过getActivity()方法来获得Activity的实例，然后就可以调用findViewById()的方法得到其中的EditText控件。</p>
</li>
<li><p>在Activity中调用Fragment中的方法：（要用到接口回调）<br>activity也可以获得一个fragment的引用，从而调用fragment中的方法。获得fragment的引用要用FragmentManager，之后可以调用findFragmentById() 或者 findFragmentByTag()。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExampleFragment fragment = (ExampleFragment) getFragmentManager().findFragmentById(R.id.example_fragment);</span><br></pre></td></tr></table></figure>
<p>具体例子稍后再讲。</p>
</li>
<li><p>Fragment与Fragment之间的通信：<br>既然Fragment和Activity之间的通信问题解决了，那Fragment与Fragment之间的通信也没有那么复杂。基本思路是：<br>首先在一个Fragment中可以得到与它相关联的Activity，然后再通过这个Activity去获取另外一个Fragment的实例，这样就实现了不同Fragment之间的通信。</p>
</li>
</ol>
<h3 id="十一-创建事件回调（在Activity中获取Fragment中的值）："><a href="#十一-创建事件回调（在Activity中获取Fragment中的值）：" class="headerlink" title="十一.创建事件回调（在Activity中获取Fragment中的值）："></a>十一.创建事件回调（在Activity中获取Fragment中的值）：</h3><p>一些情况下，可能需要fragment和activity共享事件，一个比较好的做法是在fragment里面定义一个回调接口，然后要求宿主activity实现这个接口。当activity通过这个接口接收到一个回调，它可以让同布局中的其他fragment分享这个信息。</p>
<p>例如，一个新闻显示应用在一个activity中有两个fragment，一个fragment A显示文章题目的列表，一个fragment B显示文章。所以当一个文章被选择的时候，fragment A必须通知activity，然后activity通知fragment B，让它显示这篇文章。（例子的代码见官方文档）</p>
<p>我们现在举一个其他的例子：</p>
<p>【实例】在Fragment中输入值，点击Activity中的按钮，弹出吐司，显示之前输入的值。其实就是让Fragment中的文本显示在Activity中</p>
<p>我们在平板的左侧加入一个fragment，完整代码如下：</p>
<p>fragment_left.xml代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;EditText</span><br><span class="line">        android:id=&quot;@+id/editText1&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:ems=&quot;10&quot; &gt;</span><br><span class="line">        &lt;requestFocus /&gt;</span><br><span class="line">    &lt;/EditText&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>其实就是加了一个EditText,方便在里面输入文本内容。</p>
<p>然后在frament中加一个接口回调，让它在Activity当中调用，方便获取输入文本的值。LeftFragment.java的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package com.example.m01_fragment05;</span><br><span class="line"></span><br><span class="line">import android.app.Fragment;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.view.LayoutInflater;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.ViewGroup;</span><br><span class="line">import android.widget.Button;</span><br><span class="line">import android.widget.EditText;</span><br><span class="line"></span><br><span class="line">public class LeftFragment extends Fragment &#123;</span><br><span class="line"></span><br><span class="line">    private Button button;</span><br><span class="line">    private EditText editText;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">            Bundle savedInstanceState) &#123;</span><br><span class="line">        View view = inflater.inflate(R.layout.fragment_left, null);</span><br><span class="line">        editText = (EditText) view.findViewById(R.id.editText1);</span><br><span class="line">        return view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onPause() &#123;</span><br><span class="line">        super.onPause();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //接口回调</span><br><span class="line">    public void getEditText(CallBack callBack) &#123;</span><br><span class="line">        String msg = editText.getText().toString();</span><br><span class="line">        callBack.getResult(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public interface CallBack &#123;</span><br><span class="line">        public void getResult(String result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码解释如下：</p>
<p>第25行：一定要为editText加一个id，不然会报空指针异常的错误；</p>
<p>34至42行：添加一个接口回调，用于获取文本的值，然后稍后再Activity当中进行调用。</p>
<p>activity_main.xml的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot;</span><br><span class="line">    tools:context=&quot;.MainActivity&quot; &gt;</span><br><span class="line"></span><br><span class="line">     &lt;LinearLayout</span><br><span class="line">        android:id=&quot;@+id/left&quot;</span><br><span class="line">        android:layout_width=&quot;224dp&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:background=&quot;#CCCCCC&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line"></span><br><span class="line">        &lt;EditText</span><br><span class="line">            android:id=&quot;@+id/editText1&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:ems=&quot;10&quot; &gt;</span><br><span class="line">            &lt;requestFocus /&gt;</span><br><span class="line">        &lt;/EditText&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/button&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;获得Fragment的值&quot; /&gt;</span><br><span class="line">    &lt;/LinearLayout&gt; </span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>其实一共就两个线性布局，左边的现性布局留给fragment，右边的线性性局留给Activity。</p>
<p>MainActivity.java的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">package com.example.m01_fragment05;</span><br><span class="line"></span><br><span class="line">import com.example.m01_fragment05.LeftFragment.CallBack;</span><br><span class="line"></span><br><span class="line">import android.app.Activity;</span><br><span class="line">import android.app.FragmentManager;</span><br><span class="line">import android.app.FragmentTransaction;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.view.Menu;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.View.OnClickListener;</span><br><span class="line">import android.widget.Button;</span><br><span class="line">import android.widget.Toast;</span><br><span class="line"></span><br><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line">    private FragmentManager manager;</span><br><span class="line">    private FragmentTransaction transaction;</span><br><span class="line">    private Button button;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        button = (Button)findViewById(R.id.button);</span><br><span class="line"></span><br><span class="line">        //动态加载leftFragment</span><br><span class="line">        manager = getFragmentManager();</span><br><span class="line">        transaction = manager.beginTransaction();</span><br><span class="line">        final LeftFragment leftFragment = new LeftFragment();</span><br><span class="line">        transaction.add(R.id.left, leftFragment, &quot;left&quot;);</span><br><span class="line">        transaction.commit();</span><br><span class="line">        button.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                //点击按钮后，通过接口回调，获取fragment当中EditText的值，并弹出吐司</span><br><span class="line">                leftFragment.getEditText(new CallBack()&#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public void getResult(String result) &#123;</span><br><span class="line">                        // TODO Auto-generated method stub</span><br><span class="line">                        Toast.makeText(MainActivity.this, result, 1).show();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onCreateOptionsMenu(Menu menu) &#123;</span><br><span class="line">        // Inflate the menu; this adds items to the action bar if it is present.</span><br><span class="line">        getMenuInflater().inflate(R.menu.main, menu);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在Activity当中动态加载Fragment，然后点击按钮，通过接口回调，获取fragment当中EditText的值，并弹出吐司。</p>
<p>程序运行后，在左侧的Fragment的EditText当中输入值，点击右侧的按钮，弹出吐司，效果如下：</p>
<img src="/2020/05/29/2021-03-09-Fragment%E5%9F%BA%E7%A1%80/img21.png" class title="This is an example image">

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/28/2021-03-08-WindowManager%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="项勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自由侠">
      <meta itemprop="description" content="万里苍穹，星辰大海">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 自由侠">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/28/2021-03-08-WindowManager%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">WindowManager基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-28 09:29:19" itemprop="dateCreated datePublished" datetime="2020-05-28T09:29:19+08:00">2020-05-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-30 22:05:08" itemprop="dateModified" datetime="2023-01-30T22:05:08+08:00">2023-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="WindowManager基础" href="/2020/05/28/2021-03-08-WindowManager%E5%9F%BA%E7%A1%80/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::440148a0339ad8e241e7929fe895a19c" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一-代码位置"><a href="#一-代码位置" class="headerlink" title="一.代码位置"></a>一.代码位置</h3><p><a target="_blank" rel="noopener" href="https://github.com/itemuse/XTester/tree/master/windowmanager">XTester-WindowManager</a><br><a target="_blank" rel="noopener" href="https://github.com/itemuse/XLib/blob/master/library/src/main/java/cn/xy/library/util/screen/XScreen.java">xlib-Screen</a><br>此文是在此基础上做的讲解,用于加深印象</p>
<h3 id="二-WindowManager介绍"><a href="#二-WindowManager介绍" class="headerlink" title="二.WindowManager介绍"></a>二.WindowManager介绍</h3><p>Android为我们提供的用于与窗口管理器进行交互的一个API！我们都知道App的界面都是 由一个个的Acitivty组成，而Activity又由View组成，当我们想显示一个界面的时候， 第一时间想起的是:Activity，对吧？又或者是Dialog和Toast。</p>
<p>但是有些情况下，前面这三者可能满足不了我们的需求，比如我们仅仅是一个简单的显示 用Activity显得有点多余了，而Dialog又需要Context对象，Toast又不可以点击… 对于以上的情况我们可以利用WindowManager这个东东添加View到屏幕上， 或者从屏幕上移除View！他就是管理Android窗口机制的一个接口，显示View的最底层！</p>
<h3 id="三-如何获得WindowManager实例"><a href="#三-如何获得WindowManager实例" class="headerlink" title="三.如何获得WindowManager实例"></a>三.如何获得WindowManager实例</h3><ul>
<li><h4 id="获得WindowManager对象"><a href="#获得WindowManager对象" class="headerlink" title="获得WindowManager对象:"></a>获得WindowManager对象:</h4></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WindowManager wManager = getApplicationContext().getSystemService(Context. WINDOW_ SERVICE);</span><br></pre></td></tr></table></figure>
<ul>
<li><h4 id="获得WindowManager-LayoutParams对象，为后续操作做准备"><a href="#获得WindowManager-LayoutParams对象，为后续操作做准备" class="headerlink" title="获得WindowManager.LayoutParams对象，为后续操作做准备"></a>获得WindowManager.LayoutParams对象，为后续操作做准备</h4></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WindowManager.LayoutParams wmParams=new WindowManager.LayoutParams();</span><br></pre></td></tr></table></figure>

<h3 id="四-WindowManager使用实例："><a href="#四-WindowManager使用实例：" class="headerlink" title="四.WindowManager使用实例："></a>四.WindowManager使用实例：</h3><ul>
<li><h4 id="实例1：获取屏幕宽高"><a href="#实例1：获取屏幕宽高" class="headerlink" title="实例1：获取屏幕宽高"></a>实例1：获取屏幕宽高</h4></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Return the width of screen, in pixel.</span><br><span class="line"> *</span><br><span class="line"> * @return the width of screen, in pixel</span><br><span class="line"> */</span><br><span class="line">public static int getScreenWidth() &#123;</span><br><span class="line">    WindowManager wm = (WindowManager) getApp().getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">    if (wm == null) return -1;</span><br><span class="line">    Point point = new Point();</span><br><span class="line">    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN_MR1) &#123;</span><br><span class="line">        wm.getDefaultDisplay().getRealSize(point);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        wm.getDefaultDisplay().getSize(point);</span><br><span class="line">    &#125;</span><br><span class="line">    return point.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Return the height of screen, in pixel.</span><br><span class="line"> *</span><br><span class="line"> * @return the height of screen, in pixel</span><br><span class="line"> */</span><br><span class="line">public static int getScreenHeight() &#123;</span><br><span class="line">    WindowManager wm = (WindowManager) getApp().getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">    if (wm == null) return -1;</span><br><span class="line">    Point point = new Point();</span><br><span class="line">    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN_MR1) &#123;</span><br><span class="line">        wm.getDefaultDisplay().getRealSize(point);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        wm.getDefaultDisplay().getSize(point);</span><br><span class="line">    &#125;</span><br><span class="line">    return point.y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获取应用宽高<br>    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Return the application&#x27;s width of screen, in pixel.</span><br><span class="line"> *</span><br><span class="line"> * @return the application&#x27;s width of screen, in pixel</span><br><span class="line"> */</span><br><span class="line">public static int getAppScreenWidth() &#123;</span><br><span class="line">    WindowManager wm = (WindowManager) getApp().getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">    if (wm == null) return -1;</span><br><span class="line">    Point point = new Point();</span><br><span class="line">    wm.getDefaultDisplay().getSize(point);</span><br><span class="line">    return point.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Return the application&#x27;s height of screen, in pixel.</span><br><span class="line"> *</span><br><span class="line"> * @return the application&#x27;s height of screen, in pixel</span><br><span class="line"> */</span><br><span class="line">public static int getAppScreenHeight() &#123;</span><br><span class="line">    WindowManager wm = (WindowManager) getApp().getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">    if (wm == null) return -1;</span><br><span class="line">    Point point = new Point();</span><br><span class="line">    wm.getDefaultDisplay().getSize(point);</span><br><span class="line">    return point.y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<img src="/2020/05/28/2021-03-08-WindowManager%E5%9F%BA%E7%A1%80/img3.gif" class="img1.jpg) - #### 实例2：设置窗口全屏显示 <figure class=" highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,</span><br><span class="line">                WindowManager.LayoutParams.FLAG_FULLSCREEN);</span><br><span class="line">        getSupportActionBar().hide();</span><br></pre></td></tr></table> 运行结果： {% asset_img img2.jpg) - #### 实例3：保持屏幕常亮 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param activity</span><br><span class="line"> * @param keepScreenOn 是否开启屏幕常亮</span><br><span class="line"> */</span><br><span class="line">public void setKeepScreenOn(Activity activity, boolean keepScreenOn) &#123;</span><br><span class="line">    if(keepScreenOn)&#123;</span><br><span class="line">        activity.getWindow().addFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        activity.getWindow().clearFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> - #### 实例4：简单悬浮框的实现 实现代码： 一个触摸图标工具类：EasyTouchView.class <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line">package cn.xy.windowmanager;</span><br><span class="line"></span><br><span class="line">import android.annotation.SuppressLint;</span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.graphics.PixelFormat;</span><br><span class="line">import android.os.Build;</span><br><span class="line">import android.util.DisplayMetrics;</span><br><span class="line">import android.util.Log;</span><br><span class="line">import android.view.Gravity;</span><br><span class="line">import android.view.MotionEvent;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.WindowManager;</span><br><span class="line">import android.widget.Button;</span><br><span class="line"></span><br><span class="line">public class EasyTouchView&#123;</span><br><span class="line"></span><br><span class="line">    public static final String TAG = &quot;EasyTouch&quot;;</span><br><span class="line">    private static EasyTouchView mEasyTouchView;</span><br><span class="line">    private Context mContext;</span><br><span class="line"></span><br><span class="line">    public static EasyTouchView getInstance() &#123;</span><br><span class="line">        if (mEasyTouchView == null) &#123;</span><br><span class="line">            mEasyTouchView = new EasyTouchView();</span><br><span class="line">        &#125;</span><br><span class="line">        return mEasyTouchView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private WindowManager mWindowManager;</span><br><span class="line">    private int width, height;</span><br><span class="line">    private double stateHeight;</span><br><span class="line">    private WindowManager.LayoutParams layoutParams;</span><br><span class="line">    private Button iconView;</span><br><span class="line">    private float startX = 0, startY = 0;</span><br><span class="line">    private float startRawX = 0, startRawY = 0;</span><br><span class="line">    private int iconViewX = 0, iconViewY = 0;</span><br><span class="line">    private boolean isIconView = false;</span><br><span class="line"></span><br><span class="line">    private DisplayMetrics mDisplayMetrics;</span><br><span class="line"></span><br><span class="line">    public void initEasyTouch(Context mContext, DisplayMetrics displayMetrics) &#123;</span><br><span class="line">        this.mDisplayMetrics = displayMetrics;</span><br><span class="line">        this.mContext = mContext;</span><br><span class="line">        width = mDisplayMetrics.widthPixels;</span><br><span class="line">        height = mDisplayMetrics.heightPixels;</span><br><span class="line">        stateHeight = Math.ceil(25 * displayMetrics.density);</span><br><span class="line">        createWM();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void createWM() &#123;</span><br><span class="line">        mWindowManager = (WindowManager) mContext.getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">        layoutParams = new WindowManager.LayoutParams();</span><br><span class="line">        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M)&#123;</span><br><span class="line">            layoutParams.type = WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            layoutParams.type =  WindowManager.LayoutParams.TYPE_SYSTEM_ALERT;</span><br><span class="line">        &#125;</span><br><span class="line">        layoutParams.format = PixelFormat.TRANSLUCENT;</span><br><span class="line">        layoutParams.flags = WindowManager.LayoutParams.FLAG_IGNORE_CHEEK_PRESSES | WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @SuppressLint(&quot;ClickableViewAccessibility&quot;)</span><br><span class="line">    public void addIconView() &#123;</span><br><span class="line">        if (isIconView) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        isIconView = true;</span><br><span class="line">        if (iconView == null) &#123;</span><br><span class="line">            iconView = new Button(mContext);</span><br><span class="line">            iconView.setBackgroundResource(R.mipmap.ic_launcher);</span><br><span class="line">            iconView.setOnTouchListener(new View.OnTouchListener() &#123;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                public boolean onTouch(View v, MotionEvent event) &#123;</span><br><span class="line">                    float rawX = event.getRawX();</span><br><span class="line">                    float rawY = (float) (event.getRawY() - stateHeight);</span><br><span class="line"></span><br><span class="line">                    int sumX = (int) (rawX - startRawX);</span><br><span class="line">                    int sumY = (int) (event.getRawY() - startRawY);</span><br><span class="line"></span><br><span class="line">                    switch (event.getAction()) &#123;</span><br><span class="line">                    case MotionEvent.ACTION_DOWN:</span><br><span class="line">                        Log.i(&quot;Log&quot;, &quot;Action_Down&quot;);</span><br><span class="line">                        startX = event.getX();</span><br><span class="line">                        startY = event.getY();</span><br><span class="line">                        startRawX = event.getRawX();</span><br><span class="line">                        startRawY = event.getRawY();</span><br><span class="line"></span><br><span class="line">                        layoutParams.alpha = 1f;</span><br><span class="line">                        mWindowManager.updateViewLayout(iconView, layoutParams);</span><br><span class="line">                        break;</span><br><span class="line">                    case MotionEvent.ACTION_UP:</span><br><span class="line">/*                        layoutParams.alpha = 0.6f;</span><br><span class="line">                        mWindowManager.updateViewLayout(iconView, layoutParams);</span><br><span class="line">                        if (sumX &gt; -10 &amp;&amp; sumX &lt; 10 &amp;&amp; sumY &gt; -10 &amp;&amp; sumY &lt; 10) &#123;</span><br><span class="line">                            removeIcon();</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            float endRawX = rawX - startX;</span><br><span class="line">                            float endRawY = rawY - startY;</span><br><span class="line">                            if (endRawX &lt; width / 2) &#123;</span><br><span class="line">                                if (endRawX &gt; endRawY) &#123;</span><br><span class="line">                                    if (rawY &gt; iconView.getHeight() * 2) &#123;</span><br><span class="line">                                        updateIconViewPosition(endRawX, endRawY);</span><br><span class="line">                                    &#125; else &#123;</span><br><span class="line">                                        updateIconViewPosition(endRawX, 0);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; else if (endRawX &gt; height - event.getRawY() - 98) &#123;</span><br><span class="line">                                    if ((float) (height - stateHeight - endRawY - 98) &gt; iconView.getHeight() * 2) &#123;</span><br><span class="line">                                        updateIconViewPosition(endRawX, endRawY);</span><br><span class="line">                                    &#125; else &#123;</span><br><span class="line">                                        updateIconViewPosition(endRawX, (float) (height - stateHeight - 98));</span><br><span class="line"></span><br><span class="line">                                    &#125;</span><br><span class="line"></span><br><span class="line">                                &#125; else &#123;</span><br><span class="line">                                    if (endRawX &gt; iconView.getWidth() * 2) &#123;</span><br><span class="line">                                        updateIconViewPosition(endRawX, endRawY);</span><br><span class="line"></span><br><span class="line">                                    &#125; else &#123;</span><br><span class="line">                                        updateIconViewPosition(0, endRawY);</span><br><span class="line"></span><br><span class="line">                                    &#125;</span><br><span class="line"></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                if (width - endRawX - 98 &gt; endRawY) &#123;</span><br><span class="line">                                    if (rawY &gt; iconView.getHeight() * 2) &#123;</span><br><span class="line">                                        updateIconViewPosition(endRawX, endRawY);</span><br><span class="line">                                    &#125; else &#123;</span><br><span class="line">                                        updateIconViewPosition(endRawX, 0);</span><br><span class="line"></span><br><span class="line">                                    &#125;</span><br><span class="line"></span><br><span class="line">                                &#125; else if (width - endRawX - 98 &gt; height - event.getRawY() - 98) &#123;</span><br><span class="line">                                    if ((float) (height - stateHeight - endRawY - 98) &gt; iconView.getHeight() * 2) &#123;</span><br><span class="line">                                        updateIconViewPosition(endRawX, endRawY);</span><br><span class="line">                                    &#125; else &#123;</span><br><span class="line">                                        updateIconViewPosition(endRawX, (float) (height - stateHeight - 98));</span><br><span class="line">                                    &#125;</span><br><span class="line"></span><br><span class="line">                                &#125; else &#123;</span><br><span class="line">                                    if (width - endRawX - 98 &gt; iconView.getWidth() * 2) &#123;</span><br><span class="line">                                        updateIconViewPosition(endRawX, endRawY);</span><br><span class="line"></span><br><span class="line">                                    &#125; else &#123;</span><br><span class="line">                                        updateIconViewPosition(width, endRawY);</span><br><span class="line">                                    &#125;</span><br><span class="line"></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        startX = 0;</span><br><span class="line">                        startY = 0;</span><br><span class="line">                        startRawX = 0;</span><br><span class="line">                        startRawY = 0;*/</span><br><span class="line">                        break;</span><br><span class="line">                    case MotionEvent.ACTION_MOVE:</span><br><span class="line">                        if (sumX &lt; -10 || sumX &gt; 10 || sumY &lt; -10 || sumY &gt; 10) &#123;</span><br><span class="line">                            updateIconViewPosition(rawX - startX, rawY - startY);</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    default:</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        layoutParams.alpha = 0.5f;</span><br><span class="line">        layoutParams.x = iconViewX;</span><br><span class="line">        layoutParams.y = iconViewY;</span><br><span class="line">        layoutParams.width = 170;</span><br><span class="line">        layoutParams.height = 170;</span><br><span class="line">        layoutParams.gravity = Gravity.LEFT | Gravity.TOP;</span><br><span class="line">        mWindowManager.addView(iconView, layoutParams);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void updateIconViewPosition(float x, float y) &#123;</span><br><span class="line">        iconViewX = (int) x;</span><br><span class="line">        iconViewY = (int) y;</span><br><span class="line">        layoutParams.x = (int) x;</span><br><span class="line">        layoutParams.y = (int) y;</span><br><span class="line">        mWindowManager.updateViewLayout(iconView, layoutParams);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void removeIcon() &#123;</span><br><span class="line">        if (isIconView &amp;&amp; iconView != null) &#123;</span><br><span class="line">            mWindowManager.removeView(iconView);</span><br><span class="line">            isIconView = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure> 开关控制 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public void onClick(View view)&#123;</span><br><span class="line">    switch (view.getId())&#123;</span><br><span class="line">        case R.id.open:</span><br><span class="line">            EasyTouchView.getInstance().addIconView();</span><br><span class="line">            break;</span><br><span class="line">        case R.id.close:</span><br><span class="line">            EasyTouchView.getInstance().removeIcon();</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 接着AndroidManifest.xml加上权限，以及为MainService进行注册： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;/&gt;</span><br></pre></td></tr></table></figure> 运行效果图： {% asset_img" title="This is an example image">

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/26/2021-03-11-%E5%B9%BF%E6%92%AD%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="项勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自由侠">
      <meta itemprop="description" content="万里苍穹，星辰大海">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 自由侠">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/26/2021-03-11-%E5%B9%BF%E6%92%AD%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">广播基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-26 09:31:14" itemprop="dateCreated datePublished" datetime="2020-05-26T09:31:14+08:00">2020-05-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-30 22:06:22" itemprop="dateModified" datetime="2023-01-30T22:06:22+08:00">2023-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="广播基础" href="/2020/05/26/2021-03-11-%E5%B9%BF%E6%92%AD%E5%9F%BA%E7%A1%80/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::41711c279ae4257bc8d57df23f39f1ef" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一-广播"><a href="#一-广播" class="headerlink" title="一.广播"></a>一.广播</h3><ul>
<li><p>广播的生命周期很短，经过调用对象–&gt;实现onReceive–&gt;结束，整个过程就结束了。从实现的复杂度和代码量来看，广播无疑是最迷你的Android 组件，实现往往只需几行代码。广播对象被构造出来后通常只执行BroadcastReceiver.onReceive方法，便结束了其生命周期。所以有的时候我们可以把它当做函数看也未必不可。</p>
</li>
<li><p>和所有组件一样，广播对象也是在应用进程的主线程中被构造，所以广播对象的执行必须是要同步且快速的。也不推荐在里面开子线程，因为往往线程还未结束，广播对象就已经执行完毕被系统销毁。如果需要完成一项比较耗时的工作 , 应该通过发送 Intent 给 Service, 由 Service 来完成。</p>
</li>
<li><p>每次广播到来时 , 会重新创建 BroadcastReceiver 对象 , 并且调用 onReceive() 方法 , 执行完以后 , 该对象即被销毁 . 当 onReceive() 方法在 10 秒内没有执行完毕， Android 会认为该程序无响应。</p>
</li>
</ul>
<h3 id="二-接收系统广播："><a href="#二-接收系统广播：" class="headerlink" title="二.接收系统广播："></a>二.接收系统广播：</h3><p>广播接收器可以自由地对自己感兴趣的广播进行注册，这样当有相应的广播发出时，广播接收器就能收到该广播，并在内部处理相应的逻辑。注册广播的方式有两种，在代码中注册和在清单文件中注册，前者称为动态注册，后者称为静态注册。</p>
<ol>
<li><p>动态注册监听网络变化：<br>新建工程文件，首先在MainActivity中定义一个内部类netWorkChangeReceiver，并重写父类的onReceive()方法，这样每当网络状态发生变化时，onReceive()方法就会得到执行，这里使用Toast提示一段文本信息，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class netWorkChangeReceiver extends BroadcastReceiver &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">            Toast.makeText(context, &quot;network changes&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>紧接着在onCreate方法中进行动态注册，然后在onDestroy方法中进行取消注册：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> private IntentFilter intentFilter;</span><br><span class="line"> private netWorkChangeReceiver netWorkChangeReceiver;</span><br><span class="line"> </span><br><span class="line"> @Override</span><br><span class="line"> protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">     super.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">     </span><br><span class="line">     //动态注册：创建一个IntentFilter的实例，添加网络变化的广播(功能是对组件进行过滤，只获取需要的消息)</span><br><span class="line">    intentFilter = new IntentFilter();</span><br><span class="line">    intentFilter.addAction(&quot;android.net.conn.CONNECTIVITY_CHANGE&quot;);</span><br><span class="line">   //创建NetWorkChangeReceiver的实例，并调用registerReceiver()方法进行注册</span><br><span class="line">   netWorkChangeReceiver = new netWorkChangeReceiver();</span><br><span class="line">    registerReceiver(netWorkChangeReceiver, intentFilter);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//取消注册，一定要记得，不然系统会报错</span><br><span class="line">@Override</span><br><span class="line">protected void onDestroy() &#123;</span><br><span class="line">    super.onDestroy();</span><br><span class="line">    unregisterReceiver(netWorkChangeReceiver);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上方代码解释如下：<br>11行：给意图过滤器intentFilter添加一个值为android.net.conn.CONNECTIVITY_CHANGE的action。因为每当网络状态发生变化时，系统就会发出一条值为android.net.conn.CONNECTIVITY_CHANG的广播。<br>注：最后要记得，动态注册的广播接收器一定要取消注册才行。<br>运行程序，就可以了。<br>不过只是提醒网络发生变化还不够人性化，为了能够准确的告诉用户当前是有网络还是没有网络，我们还需要对上述代码进一步优化，修改netWorkChangeReceiver中的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class netWorkChangeReceiver extends BroadcastReceiver &#123;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">        //通过getSystemService()方法得到connectionManager这个系统服务类，专门用于管理网络连接</span><br><span class="line">        ConnectivityManager connectionManager = (ConnectivityManager)getSystemService(Context.CONNECTIVITY_SERVICE);</span><br><span class="line">        NetworkInfo networkInfo = connectionManager.getActiveNetworkInfo();</span><br><span class="line">        if(networkInfo != null &amp;&amp; networkInfo.isAvailable())&#123;</span><br><span class="line">            Toast.makeText(context, &quot;network is available&quot;,Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            Toast.makeText(context, &quot;network is unavailable&quot;,Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上方代码解释：<br>06行：在onReceive()方法中，首先通过通过getSystemService()方法得到connectionManager这个系统服务类，专门用于管理网络连接。<br>07行：然后调用它的getActiveNetworkInfo()方法可以得到NetworkInfo的实例，接着调用NetworkInfo的isAvailable()方法，就可以判断当前是否有网络了，最后通过Toast提示用户。<br>另外，查询系统的网络状态是需要申明权限的，打开清单文件，添加如下权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>注：访问<a target="_blank" rel="noopener" href="http://developer.android.com/reference/android/Manifest.permission.html%E5%8F%AF%E4%BB%A5%E6%9F%A5%E7%9C%8BAndroid%E7%B3%BB%E7%BB%9F%E6%89%80%E6%9C%89%E7%9A%84%E5%8F%AF%E5%A3%B0%E6%98%8E%E7%9A%84%E6%9D%83%E9%99%90%E3%80%82">http://developer.android.com/reference/android/Manifest.permission.html可以查看Android系统所有的可声明的权限。</a><br>现在运行程序，就可以了。<br>上方程序完整版代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package com.example.m05_broadcastreceiver01;</span><br><span class="line">import android.app.Activity;</span><br><span class="line">import android.content.BroadcastReceiver;</span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.content.Intent;</span><br><span class="line">import android.content.IntentFilter;</span><br><span class="line">import android.net.ConnectivityManager;</span><br><span class="line">import android.net.NetworkInfo;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.widget.Toast;</span><br><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line">    private IntentFilter intentFilter;</span><br><span class="line">    private netWorkChangeReceiver netWorkChangeReceiver;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        // 动态注册：创建一个IntentFilter的实例，添加网络变化的广播</span><br><span class="line">        intentFilter = new IntentFilter();</span><br><span class="line">        intentFilter.addAction(&quot;android.net.conn.CONNECTIVITY_CHANGE&quot;);</span><br><span class="line">        // 创建NetWorkChangeReceiver的实例，并调用registerReceiver()方法进行注册</span><br><span class="line">        netWorkChangeReceiver = new netWorkChangeReceiver();</span><br><span class="line">        registerReceiver(netWorkChangeReceiver, intentFilter);</span><br><span class="line">    &#125;</span><br><span class="line">    // 取消注册，一定要记得，不然系统会报错</span><br><span class="line">    @Override</span><br><span class="line">    protected void onDestroy() &#123;</span><br><span class="line">        super.onDestroy();</span><br><span class="line">        unregisterReceiver(netWorkChangeReceiver);</span><br><span class="line">    &#125;</span><br><span class="line">    class netWorkChangeReceiver extends BroadcastReceiver &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">            //通过getSystemService()方法得到connectionManager这个系统服务类，专门用于管理网络连接</span><br><span class="line">            ConnectivityManager connectionManager = (ConnectivityManager)getSystemService(Context.CONNECTIVITY_SERVICE);</span><br><span class="line">            NetworkInfo networkInfo = connectionManager.getActiveNetworkInfo();</span><br><span class="line">            if(networkInfo != null &amp;&amp; networkInfo.isAvailable())&#123;</span><br><span class="line">                Toast.makeText(context, &quot;network is available&quot;,Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                Toast.makeText(context, &quot;network is unavailable&quot;,Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>静态注册实现开机启动：<br>动态注册的方式比较灵活，但缺点是：必须在程序启动之后才能接收到广播，因为注册的逻辑是写在onCreate()方法中的。为了让程序在未启动的情况下就能接收到广播，这里就需要使用到静态注册。<br>这里我们准备让程序接收一条开机广播，当收到这条广播时，就可以在onReceive()方法中执行相应的逻辑，从而实现开机启动的功能。<br>新建一个类：BootCompleteReceiver，让他继承BroadcastReceiver，在onReceive()方法中简单地Toast一下，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class BootCompleteReceiver extends BroadcastReceiver &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">        Toast.makeText(context, &quot;Boot Complete&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，这里不再使用内部类的方式来定义广播接收器，因为稍后我们需要在清单文件AndroidManifest.xml中将这个广播接收器的类名注册进去。<br>然后修改清单文件AndroidManifest.xml，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-sdk</span><br><span class="line">        android:minSdkVersion=&quot;8&quot;</span><br><span class="line">        android:targetSdkVersion=&quot;16&quot; /&gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;/&gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;application</span><br><span class="line">        android:allowBackup=&quot;true&quot;</span><br><span class="line">        android:icon=&quot;@drawable/ic_launcher&quot;</span><br><span class="line">        android:label=&quot;@string/app_name&quot;</span><br><span class="line">        android:theme=&quot;@style/AppTheme&quot; &gt;</span><br><span class="line">        &lt;activity</span><br><span class="line">            android:name=&quot;com.example.m05_broadcastreceiver01.MainActivity&quot;</span><br><span class="line">            android:label=&quot;@string/app_name&quot; &gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</span><br><span class="line"></span><br><span class="line">                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;receiver android:name=&quot;.BootCompleteReceiver&quot;&gt;</span><br><span class="line">            &lt;intent-filter &gt;</span><br><span class="line">                &lt;action android:name=&quot;android.intent.action.BOOT_COMPLETED&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/receiver&gt;</span><br><span class="line">    &lt;/application&gt;</span><br></pre></td></tr></table></figure>
<p>代码解释如下：<br>终于，<application>标签内多了个子标签<receiver>，所有的静态注册的广播接收器都是在这里进行注册的。<br>22行：name中为广播接收器的名字<br>24行：想要接收的广播。Android系统启动完成后，会发出这条名为android.intent.action.BOOT_COMPLETED的广播。<br>05行：监听系统开机广播需要声明权限。<br>运行程序后，将手机关机重启，就能收到这条广播了。</receiver></application></p>
</li>
</ol>
<h3 id="三-发送自定义广播"><a href="#三-发送自定义广播" class="headerlink" title="三.发送自定义广播"></a>三.发送自定义广播</h3><ol>
<li><p>发送标准广播　　<br>新建工程文件。在发广播之前，我们先定义一个广播接收器来接收此广播才行。因此，新建一个类：MyBroadcastReceiver，让他继承BroadcastReceiver，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class MyBroadcastReceiver extends BroadcastReceiver &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">        Toast.makeText(context, &quot;received in MyBroadcastReceiver&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里，当MyBroadcastReceiver 收到自定义的广播时，就会执行onReceive()方法中的逻辑，弹出一个Toast。<br>紧接着，要在清单文件AndroidManifest.xml中对这个广播接收器进行注册：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;application</span><br><span class="line">    android:allowBackup=&quot;true&quot;</span><br><span class="line">    android:icon=&quot;@drawable/ic_launcher&quot;</span><br><span class="line">    android:label=&quot;@string/app_name&quot;</span><br><span class="line">    android:theme=&quot;@style/AppTheme&quot; &gt;</span><br><span class="line">    &lt;activity</span><br><span class="line">        android:name=&quot;com.example.m05_broadcastreceiver02.MainActivity&quot;</span><br><span class="line">        android:label=&quot;@string/app_name&quot; &gt;</span><br><span class="line">        &lt;intent-filter&gt;</span><br><span class="line">            &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</span><br><span class="line"> </span><br><span class="line">            &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</span><br><span class="line">        &lt;/intent-filter&gt;</span><br><span class="line">    &lt;/activity&gt;</span><br><span class="line">    </span><br><span class="line">   &lt;receiver android:name=&quot;.MyBroadcastReceiver&quot;&gt;</span><br><span class="line">        &lt;intent-filter &gt;</span><br><span class="line">            &lt;action android:name=&quot;com.example.m05_broadcastreceiver02.MY_BROADCAST&quot;/&gt;</span><br><span class="line">        &lt;/intent-filter&gt;</span><br><span class="line">    &lt;/receiver&gt;</span><br><span class="line">&lt;/application&gt;</span><br></pre></td></tr></table></figure>
<p>代码解释：<br>18行：让MyBroadcastReceiver接收一条值为om.example.m05_broadcastreceiver02.MY_BROADCAST的广播，因此待会儿在发送广播的时候，我们就需要发出这样的一条广播。<br>紧接着，修改activity.xml中的代码，添加一个按钮Button。<br>然后，修改MainActivity.java中的代码，添加Button的监听事件：点击按钮时，发送广播</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Button button1=(Button)findViewById(R.id.button1);</span><br><span class="line">button1.setOnClickListener(new OnClickListener() &#123;            </span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        Intent intent =new Intent(&quot;com.example.m05_broadcastreceiver02.MY_BROADCAST&quot;);</span><br><span class="line">        sendBroadcast(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>总结：可以看到，点击按钮时，发送com.example.m05_broadcastreceiver02.MY_BROADCAST这条广播，这样，所有能够监听com.example.m05_broadcastreceiver02.MY_BROADCAST这条广播的广播接收器就都会同时收到消息，此时发出去的就是一条标准广播，即无序广播。所以接下来就需要讲到有序广播。</p>
</li>
<li><p>发送有序广播：<br>广播是一种可以跨进程的通信方式，其他应用程序是可以收到的。现在我们来发一条有序广播。<br>有序广播不仅有先后顺序，而且前面的广播还可以将后面的广播截断。<br>在3.1的代码基础之上，将按钮的监听事件修改如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Button button1=(Button)findViewById(R.id.button1);</span><br><span class="line">button1.setOnClickListener(new OnClickListener() &#123;            </span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        Intent intent =new Intent(&quot;com.example.m05_broadcastreceiver02.MY_BROADCAST&quot;);</span><br><span class="line">        sendOrderedBroadcast(intent, null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>即将06行代码修改一下，将sendBroadcast()方法改为sendOrderedBroadcast()方法，sendOrderedBroadcast()方法接收两个参数，第二个参数是一个与权限相关的字符串，这里传入null即可。<br>紧接着，修改清单文件AndroidManifest.xml中对广播接收器的注册，设置优先级：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;receiver android:name=&quot;.MyBroadcastReceiver&quot;&gt;</span><br><span class="line">    &lt;intent-filter android:priority=&quot;100&quot;&gt;</span><br><span class="line">       &lt;action android:name=&quot;com.example.m05_broadcastreceiver02.MY_BROADCAST&quot;/&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">&lt;/receiver&gt;</span><br></pre></td></tr></table></figure>
<p>即添加第02行代码。可以看到，通过android:priority属性给广播接收器设置了优先级。这个属性的范围在-1000到1000，数值越大，优先级越高。<br>接下来，如果想要拦截这个广播，防止让后面的广播接收器也接收到了这个广播。可以修改MyBroadcastReceiver中的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class MyBroadcastReceiver extends BroadcastReceiver &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">        Toast.makeText(context, &quot;received in MyBroadcastReceiver&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">        abortBroadcast();//拦截广播，防止后面的接收到</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即添加第06行代码。如果在onReceive()方法中调用了abortBroadcast()方法，就表示是将这条广播拦截，后面的广播接收器将无法再接收到。<br>特别关注：<br>广播接收器的生命周期：关键在于BroadcastReceiver中的onReceive()方法，从onReceive()里的第一行代码开始，onReceive()里的最后一行代码结束。<br>一个广播到来的时候，用什么方式提醒用户是最友好的呢？第一种方式是吐司，第二种方式是通知。注：不要使用对话框，以免中断了用户正在进行的操作。</p>
</li>
</ol>
<h3 id="四-使用本地广播："><a href="#四-使用本地广播：" class="headerlink" title="四.使用本地广播："></a>四.使用本地广播：</h3><p>之前我们发送和接收的广播全部都是属于全局广播，即发出去的广播可以被其他任何应用程序接收到，并且我们也可以接收来自于其他任何应用程序的广播。这样一来，必然会造成安全问题。于是便有了本地广播：即只能在本应用程序中发送和接收广播。这就要使用到了LocalBroadcastManager这个类来对广播进行管理。<br>我们修改2.1中动态注册广播接收器的代码，即修改MainActivity.java中的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">package com.example.broadcasttest;</span><br><span class="line"></span><br><span class="line">import android.app.Activity;</span><br><span class="line">import android.content.BroadcastReceiver;</span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.content.Intent;</span><br><span class="line">import android.content.IntentFilter;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.support.v4.content.LocalBroadcastManager;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.View.OnClickListener;</span><br><span class="line">import android.widget.Button;</span><br><span class="line">import android.widget.Toast;</span><br><span class="line"></span><br><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line">    private IntentFilter intentFilter;</span><br><span class="line"></span><br><span class="line">    private LocalReceiver localReceiver;</span><br><span class="line"></span><br><span class="line">    private LocalBroadcastManager localBroadcastManager;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        //通过LocalBroadcastManager的getInstance()方法得到它的一个实例</span><br><span class="line">        localBroadcastManager = LocalBroadcastManager.getInstance(this);</span><br><span class="line">        Button button = (Button) findViewById(R.id.button);</span><br><span class="line">        button.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Intent intent = new Intent(</span><br><span class="line">                        &quot;com.example.broadcasttest.LOCAL_BROADCAST&quot;);</span><br><span class="line">                localBroadcastManager.sendBroadcast(intent);//调用sendBroadcast()方法发送广播</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        //动态注册本地的广播接收器</span><br><span class="line">        intentFilter = new IntentFilter();</span><br><span class="line">        intentFilter.addAction(&quot;com.example.broadcasttest.LOCAL_BROADCAST&quot;);</span><br><span class="line">        localReceiver = new LocalReceiver();</span><br><span class="line">        localBroadcastManager.registerReceiver(localReceiver, intentFilter);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onDestroy() &#123;</span><br><span class="line">        super.onDestroy();</span><br><span class="line">        localBroadcastManager.unregisterReceiver(localReceiver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class LocalReceiver extends BroadcastReceiver &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">            Toast.makeText(context, &quot;received local broadcast&quot;,</span><br><span class="line">                    Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：本地广播是无法通过静态注册的方式来接收的。其实也完全可以理解，因为静态注册主要就是为了让程序在未启动的情况下也能收到广播。而发送本地广播时，我们的程序肯定是已经启动了，没有必要使用到静态注册的功能。</p>
<h3 id="五-各种各样的广播："><a href="#五-各种各样的广播：" class="headerlink" title="五.各种各样的广播："></a>五.各种各样的广播：</h3><p>在android中有很多系统自带的intent.action，通过监听这些事件我们可以完成很多功能。</p>
<ol>
<li>开机：<br>String BOOT_COMPLETED_ACTION 广播：在系统启动后。这个动作被广播一次（只有一次）。监听： <code>android.intent.action.BOOT_COMPLETED</code></li>
<li>电话拨入：<br>String ANSWER_ACTION 动作：处理拨入的电话。监听： <code>android.intent.action.ANSWER</code></li>
<li>电量变化：<br>String BATTERY_CHANGED_ACTION 广播：充电状态，或者电池的电量发生变化。监听： <code>android.intent.action.BATTERY_CHANGED</code></li>
<li>日期改变：<br>String DATE_CHANGED_ACTION 广播：日期被改变。 监听：<code>android.intent.action.DATE_CHANGED</code></li>
<li>取消更新下载：<br>String FOTA_CANCEL_ACTION 广播：取消所有被挂起的 (pending) 更新下载。 监听：<code>android.server.checkin.FOTA_CANCEL</code></li>
<li>更新开始安装：<br>String FOTA_READY_ACTION 广播：更新已经被下载 可以开始安装。监听 <code>android.server.checkin.FOTA_READY</code></li>
<li>主屏幕：<br>String HOME_CATEGORY 类别：主屏幕 (activity)。设备启动后显示的第一个 activity。 监听：”android.intent.category.HOME&#96;</li>
<li>新应用：<br>String PACKAGE_ADDED_ACTION 广播：设备上新安装了一个应用程序包。监听： <code>android.intent.action.PACKAGE_ADDED</code></li>
<li>删除应用：<br>String PACKAGE_REMOVED_ACTION 广播：设备上删除了一个应用程序包。监听： <code>android.intent.action.PACKAGE_REMOVED</code></li>
<li>屏幕关闭：<br>String SCREEN_OFF_ACTION 广播：屏幕被关闭。监听： <code>android.intent.action.SCREEN_OFF</code></li>
<li>屏幕开启：<br>String SCREEN_ON_ACTION 广播：屏幕已经被打开。 监听：<code>android.intent.action.SCREEN_ON</code></li>
<li>时区改变：<br>String TIMEZONE_CHANGED_ACTION 广播：时区已经改变。监听： <code>android.intent.action.TIMEZONE_CHANGED</code></li>
<li>时间改变：<br>String TIME_CHANGED_ACTION 广播：时间已经改变（重新设置）。 <code>android.intent.action.TIME_SET</code></li>
<li>时间流逝：<br>String TIME_TICK_ACTION 广播：当前时间已经变化（正常的时间流逝）。 <code>android.intent.action.TIME_TICK</code></li>
<li>进入大容量存储模式：<br>String UMS_CONNECTED_ACTION 广播：设备进入 USB 大容量存储模式。 <code>android.intent.action.UMS_CONNECTED</code></li>
<li>退出大容量存储模式：<br>String UMS_DISCONNECTED_ACTION 广播：设备从 USB 大容量存储模式退出。 <code>android.intent.action.UMS_DISCONNECTED</code></li>
<li>壁纸改变：<br>String WALLPAPER_CHANGED_ACTION 广播：系统的墙纸已经改变。 <code>android.intent.action.WALLPAPER_CHANGED</code></li>
<li>web搜索：<br>String WEB_SEARCH_ACTION 动作：执行 web 搜索。 <code>android.intent.action.WEB_SEARCH</code></li>
<li>网络变化：<br>String CONNECTIVITY_CHANGE_ACTION 动作：网络变化。<code>android.intent.action.CONNECTIVITY_CHANGE_ACTION</code></li>
</ol>
<h3 id="六-实例：使用动态注册，监听手机的电量变化。"><a href="#六-实例：使用动态注册，监听手机的电量变化。" class="headerlink" title="六.实例：使用动态注册，监听手机的电量变化。"></a>六.实例：使用动态注册，监听手机的电量变化。</h3><p>完整版代码如下：</p>
<ul>
<li><p>activity_main.xml代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;</span><br><span class="line">    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</span><br><span class="line">   android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</span><br><span class="line">    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</span><br><span class="line">    tools:context=&quot;.MainActivity&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/textView1&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textSize=&quot;30dp&quot;</span><br><span class="line">        android:gravity=&quot;center&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt; </span><br></pre></td></tr></table></figure>
</li>
<li><p>MainActivity.java的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">package com.example.m05_broadcastreceiver02;</span><br><span class="line"></span><br><span class="line">import android.app.Activity;</span><br><span class="line">import android.content.BroadcastReceiver;</span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.content.Intent;</span><br><span class="line">import android.content.IntentFilter;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.widget.TextView;</span><br><span class="line"></span><br><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    private BatteryBroadcastReceiver batteryBroadcastReceiver;</span><br><span class="line">    private TextView textView;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        textView=(TextView)findViewById(R.id.textView1);</span><br><span class="line">        </span><br><span class="line">        //动态注册监听电量的广播接收器</span><br><span class="line">        IntentFilter intentFilter = new IntentFilter();</span><br><span class="line">        intentFilter.addAction(&quot;android.intent.action.BATTERY_CHANGED&quot;);</span><br><span class="line">        batteryBroadcastReceiver = new BatteryBroadcastReceiver();</span><br><span class="line">        registerReceiver(batteryBroadcastReceiver, intentFilter);       </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //取消注册监听电量的广播接收器</span><br><span class="line">    @Override</span><br><span class="line">    protected void onDestroy() &#123;</span><br><span class="line">        super.onDestroy();</span><br><span class="line">        unregisterReceiver(batteryBroadcastReceiver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //新建一个广播接收器，监听电量的变化</span><br><span class="line">    public class BatteryBroadcastReceiver extends BroadcastReceiver &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">            if(intent.getAction().equals(Intent.ACTION_BATTERY_CHANGED)) &#123;</span><br><span class="line">                //获取当前电量</span><br><span class="line">                int level = intent.getIntExtra(&quot;level&quot;, 0);</span><br><span class="line">                //电量的总刻度</span><br><span class="line">                int scale = intent.getIntExtra(&quot;scale&quot;, 100);</span><br><span class="line">                textView.setText(&quot;电池电量为&quot;+((level*100) / scale)+&quot;%&quot;);</span><br><span class="line">                </span><br><span class="line">                //当电量低时，可以进行一些操作，例如弹出通知等</span><br><span class="line">/*                if(level&lt;15)&#123;</span><br><span class="line">                    do something</span><br><span class="line">                &#125;*/</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;         </span><br><span class="line">   &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>紧接着，在清单文件中进行权限声明：</p>
<uses-permission android:name="android.permission.BATTERY_STATS">
MainActivity.java的代码解释如下：
40至45行：固定代码，用于获取当前电量
48至50行：当电量低时，可以进行一些操作，例如弹出通知等
</uses-permission></li>
<li><p>运行后，界面如下：</p>
<img src="/2020/05/26/2021-03-11-%E5%B9%BF%E6%92%AD%E5%9F%BA%E7%A1%80/img.png" class title="This is an example image"></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="项勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自由侠">
      <meta itemprop="description" content="万里苍穹，星辰大海">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 自由侠">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">Intent基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-25 14:25:09" itemprop="dateCreated datePublished" datetime="2020-05-25T14:25:09+08:00">2020-05-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-30 22:06:24" itemprop="dateModified" datetime="2023-01-30T22:06:24+08:00">2023-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Intent基础" href="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::f7bc51c61f1915576f0465c645e46a11" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一-什么是intent"><a href="#一-什么是intent" class="headerlink" title="一.什么是intent"></a>一.什么是intent</h3><ul>
<li>Android中提供了Intent机制来协助应用间的交互与通讯，或者采用更准确的说法是，Intent不仅可用于应用程序之间，也可用于应用程序内部的activity, service和broadcast receiver之间的交互。Intent这个英语单词的本意是“目的、意向、意图”。</li>
<li>Intent是一种运行时绑定（runtime binding)机制，它能在程序运行的过程中连接两个不同的组件。通过Intent，你的程序可以向Android表达某种请求或者意愿，Android会根据意愿的内容选择适当的组件来响应。</li>
</ul>
<p>activity、service和broadcast receiver之间是通过Intent进行通信的，而另外一个组件Content Provider本身就是一种通信机制，不需要通过Intent。我们来看下面这个图就知道了：</p>
<img src="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/img1.png" class title="This is an example image">

<p>如果Activity1需要和Activity2进行联系，二者不需要直接联系，而是通过Intent作为桥梁。通俗来讲，Intnet类似于中介、媒婆的角色。</p>
<ul>
<li>使用Context.startActivity() 或 Activity.startActivityForResult()，传入一个intent来启动一个activity。使用 Activity.setResult()，传入一个intent来从activity中返回结果。</li>
<li>将intent对象传给Context.startService()来启动一个service或者传消息给一个运行的service。将intent对象传给 Context.bindService()来绑定一个service。</li>
<li>将intent对象传给 Context.sendBroadcast()，Context.sendOrderedBroadcast()，或者Context.sendStickyBroadcast()等广播方法，则它们被传给 broadcast receiver。</li>
</ul>
<h3 id="二-intent相关属性"><a href="#二-intent相关属性" class="headerlink" title="二.intent相关属性"></a>二.intent相关属性</h3><p>Intent 作为一个负责组件间传递消息的信息对象，最重要的就是其包含的信息。实际上无论是显式还是隐式，Intent 发出的时候，系统对应的行为正是由 Intent 所包含信息的组合决定。一个 Intent 所包含的信息如下图：</p>
<img src="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/img2.png" class title="This is an example image">

<ul>
<li>component(组件)：目的组件</li>
<li>action（动作）：用来表现意图的行动</li>
<li>category（类别）：用来表现动作的类别</li>
<li>data（数据）：表示与动作要操纵的数据</li>
<li>type（数据类型）：对于data范例的描写</li>
<li>extras（扩展信息）：扩展信息</li>
<li>Flags（标志位）：期望这个意图的运行模式</li>
</ul>
<p>Intent类型分为显式Intent（直接类型）、隐式Intent（间接类型）。官方建议使用隐式Intent。上述属性中，component属性为直接类型，其他均为间接类型。</p>
<p>相比与显式Intent，隐式Intnet则含蓄了许多，它并不明确指出我们想要启动哪一个活动，而是指定一系列更为抽象的action和category等信息，然后交由系统去分析这个Intent，并帮我们找出合适的活动去启动。</p>
<p>Activity 中 Intent Filter 的匹配过程 ：</p>
<img src="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/img3.png" class title="This is an example image">

<h3 id="三-component-组件-：目的组件"><a href="#三-component-组件-：目的组件" class="headerlink" title="三.component(组件)：目的组件"></a>三.component(组件)：目的组件</h3><p>Component属性明确指定Intent的目标组件的类名称。（属于直接Intent）</p>
<p>如果 component这个属性有指定的话，将直接使用它指定的组件。指定了这个属性以后，Intent的其它所有属性都是可选的。</p>
<p>例如，启动第二个Activity时，我们可以这样来写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                //创建一个意图对象</span><br><span class="line">                Intent intent = new Intent();</span><br><span class="line">                //创建组件，通过组件来响应</span><br><span class="line">                ComponentName component = new ComponentName(MainActivity.this, SecondActivity.class);</span><br><span class="line">                intent.setComponent(component);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>如果写的简单一点，监听事件onClick()方法里可以这样写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent();</span><br><span class="line">//setClass函数的第一个参数是一个Context对象</span><br><span class="line">//Context是一个类，Activity是Context类的子类，也就是说，所有的Activity对象，都可以向上转型为Context对象</span><br><span class="line">//setClass函数的第二个参数是一个Class对象，在当前场景下，应该传入需要被启动的Activity类的class对象</span><br><span class="line">intent.setClass(MainActivity.this, SecondActivity.class);</span><br><span class="line">startActivity(intent);   </span><br></pre></td></tr></table></figure>

<p>再简单一点，可以这样写：（当然，也是最常见的写法）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(MainActivity.this,SecondActivity.class);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>

<h3 id="四-Action（动作）：用来表现意图的行动"><a href="#四-Action（动作）：用来表现意图的行动" class="headerlink" title="四.Action（动作）：用来表现意图的行动"></a>四.Action（动作）：用来表现意图的行动</h3><p>当日常生活中，描述一个意愿或愿望的时候，总是有一个动词在其中。比如：我想“做”三个俯卧撑；我要“写” 一封情书，等等。在Intent中，Action就是描述做、写等动作的，当你指明了一个Action，执行者就会依照这个动作的指示，接受相关输入，表现对应行为，产生符合的输出。在Intent类中，定义了一批量的动作，比如ACTION_VIEW，ACTION_PICK等， 基本涵盖了常用动作。加的动作越多，越精确。</p>
<p>Action 是一个用户定义的字符串，用于描述一个 Android 应用程序组件，一个 Intent Filter 可以包含多个 Action。在 AndroidManifest.xml 的Activity 定义时，可以在其 <intent-filter>节点指定一个 Action列表用于标识 Activity 所能接受的“动作”。</intent-filter></p>
<h3 id="五-category（类别）：用来表现动作的类别"><a href="#五-category（类别）：用来表现动作的类别" class="headerlink" title="五.category（类别）：用来表现动作的类别"></a>五.category（类别）：用来表现动作的类别</h3><p>Category属性也是作为<intent-filter>子元素来声明的。例如：</intent-filter></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;intent-filter&gt;</span><br><span class="line"></span><br><span class="line">　　&lt;action android:name=&quot;com.vince.intent.MY_ACTION&quot;&gt;&lt;/action&gt;</span><br><span class="line"></span><br><span class="line">　　&lt;category android:name=&quot;com.vince.intent.MY_CATEGORY&quot;&gt;&lt;/category&gt; </span><br><span class="line"></span><br><span class="line">　　&lt;category android:name=&quot;android.intent.category.DEFAULT&quot;&gt;&lt;/category&gt; </span><br><span class="line"></span><br><span class="line">&lt;/intent-filter&gt; </span><br></pre></td></tr></table></figure>
<p>Action 和category通常是放在一起用的，所以这里一起介绍一下。我们来先来举一个例子：</p>
<p>新建一个工程文件smyh006_Intent01，在默认文件的基础之上，新建文件SecondActicity.java和activity_second.xml。</p>
<p>紧接着，我们要到清单文件中进行注册，打开AndroidManifest.xml，添加SecondActivity的action和category的过滤器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">            android:name=&quot;.SecondActivity&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                 &lt;action android:name=&quot;com.example.smyh006intent01.MY_ACTION&quot;/&gt;</span><br><span class="line">                 &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br></pre></td></tr></table></figure>

<p>上方代码，表示SecondActicity可以匹配第4行的MY_ACTION这个动作，此时，如果在其他的Acticity通过这个action的条件来查找，那SecondActicity就具备了这个条件。类似于相亲时，我要求对方有哪些条件，然后对方这个SecondActicity恰巧满足了这个条件（够通俗了吧）。</p>
<p>注：如果没有指定的category，则必须使用默认的DEFAULT（即上方第5行代码）。</p>
<p>也就是说：只有<action>和<category>中的内容同时能够匹配上Intent中指定的action和category时，这个活动才能响应Intent。如果使用的是DEFAULT这种默认的category，在稍后调用startActivity()方法的时候会自动将这个category添加到Intent中。</category></action></p>
<p>现在来修改MainActivity.java中按钮的点击事件，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                //启动另一个Activity，（通过action属性进行查找）</span><br><span class="line">                Intent intent = new Intent();</span><br><span class="line">                //设置动作（实际action属性就是一个字符串标记而已）</span><br><span class="line">                intent.setAction(&quot;com.example.smyh006intent01.MY_ACTION&quot;); //方法：Intent android.content.Intent.setAction(String action)</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>上方代码中，也可以换成下面这种简洁的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                //启动另一个Activity，（通过action属性进行查找）</span><br><span class="line">                Intent intent = new Intent(&quot;com.example.smyh006intent01.MY_ACTION&quot;);//方法： android.content.Intent.Intent(String action)</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>上方第5行代码：在这个Intent中，我并没有指定具体哪一个Activity，我只是指定了一个action的常量。所以说，隐式Intent的作用就表现的淋漓尽致了。此时，点击MainActicity中的按钮，就会跳到SecondActicity中去。</p>
<p>上述情况只有SecondActicity匹配成功。如果有多个组件匹配成功，就会以对话框列表的方式让用户进行选择。我们来详细介绍一下：</p>
<p>我们新建文件ThirdActicity.java和activity_third.xml，然后在清单文件AndroidManifest.xml中添加ThirdActivity的action和category的过滤器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">            android:name=&quot;.ThirdActivity&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                 &lt;action android:name=&quot;com.example.smyh006intent01.MY_ACTION&quot;/&gt;</span><br><span class="line">                 &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br></pre></td></tr></table></figure>
<p>此时，运行程序，当点击MainActivity中的按钮时，弹出如下界面：</p>
<img src="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/img4.png" class title="This is an example image">

<p>相信大家看到了这个界面，应该就一目了然了。于是我们可以做出如下总结：</p>
<p>在自定义动作时，使用activity组件时，必须添加一个默认的类别</p>
<p>具体的实现为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;intent-filter&gt;</span><br><span class="line">               &lt;action android:name=&quot;com.example.action.MY_ACTION&quot;/&gt;</span><br><span class="line">               &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;</span><br><span class="line">&lt;/intent-filter&gt;</span><br></pre></td></tr></table></figure>
<p>如果有多个组件被匹配成功，就会以对话框列表的方式让用户进行选择。</p>
<p>每个Intent中只能指定一个action，但却能指定多个category；类别越多，动作越具体，意图越明确（类似于相亲时，给对方提了很多要求）。</p>
<p>目前我们的Intent中只有一个默认的category，现在可以通过intent.addCategory()方法来实现。修改MainActivity中按钮的点击事件，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                //启动另一个Activity，（通过action属性进行查找）</span><br><span class="line">                Intent intent = new Intent();</span><br><span class="line">                //设置动作（实际action属性就是一个字符串标记而已）</span><br><span class="line">                intent.setAction(&quot;com.example.smyh006intent01.MY_ACTION&quot;); //方法：Intent android.content.Intent.setAction(String action)</span><br><span class="line">                intent.addCategory(&quot;com.example.smyh006intent01.MY_CATEGORY&quot;);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>既然在Intent中增加了一个category，那么我们要在清单文件中去声明这个category，不然程序将无法运行。代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">android:name=&quot;.SecondActivity&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                 &lt;action android:name=&quot;com.example.smyh006intent01.MY_ACTION&quot;/&gt;</span><br><span class="line">                 &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;</span><br><span class="line">                 &lt;category android:name=&quot;com.example.smyh006intent01.MY_CATEGORY&quot; /&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br></pre></td></tr></table></figure>
<p>此时，点击MainActicity中的按钮，就会跳到SecondActicity中去。</p>
<p>总结如下：</p>
<p>自定义类别： 在Intent添加类别可以添加多个类别，那就要求被匹配的组件必须同时满足这多个类别，才能匹配成功。操作Activity的时候，如果没有类别，须加上默认类别</p>
<h3 id="六-data（数据）：表示与动作要操纵的数据"><a href="#六-data（数据）：表示与动作要操纵的数据" class="headerlink" title="六.data（数据）：表示与动作要操纵的数据"></a>六.data（数据）：表示与动作要操纵的数据</h3><ul>
<li>Data属性是Android要访问的数据，和action和Category声明方式相同，也是在<intent-filter>中。</intent-filter></li>
<li>多个组件匹配成功显示优先级高的； 相同显示列表。</li>
</ul>
<p>Data是用一个uri对象来表示的，uri代表数据的地址，属于一种标识符。通常情况下，我们使用action+data属性的组合来描述一个意图：做什么</p>
<p>使用隐式Intent，我们不仅可以启动自己程序内的活动，还可以启动其他程序的活动，这使得Android多个应用程序之间的功能共享成为了可能。比如应用程序中需要展示一个网页，没有必要自己去实现一个浏览器（事实上也不太可能），而是只需要条用系统的浏览器来打开这个网页就行了。</p>
<p>【实例】打开指定网页：<br>MainActivity.java中，监听器部分的核心代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Intent intent = new Intent();</span><br><span class="line">                intent.setAction(Intent.ACTION_VIEW);</span><br><span class="line">                Uri data = Uri.parse(&quot;http://www.baidu.com&quot;);</span><br><span class="line">                intent.setData(data);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>当然，上方代码也可以简写成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Intent intent = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">                intent.setData(Uri.parse(&quot;http://www.baidu.com&quot;));</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>第4行代码：指定了Intent的action是 Intent.ACTION_VIEW，表示查看的意思，这是一个Android系统内置的动作；</p>
<p>第5行代码：通过Uri.parse()方法，将一个网址字符串解析成一个Uri对象，再调用intent的setData()方法将这个Uri对象传递进去。</p>
<p>当点击按钮时，将跳到如下界面：</p>
<img src="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/img5.png" class title="This is an example image">

<p>此时， 调用的是系统默认的浏览器，也就是说，只调用了这一个组件。现在如果有多个组件得到了匹配，应该是什么情况呢？</p>
<p>我们修改修改清单文件中对SecondAcivity的声明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">            android:name=&quot;.SecondActivity&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                 &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;</span><br><span class="line">                 &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;</span><br><span class="line">                 &lt;data android:scheme=&quot;http&quot; android:host=&quot;www.baidu.com&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br></pre></td></tr></table></figure>
<p>现在，SecondActivity也匹配成功了，我们运行程序，点击MainActicity的按钮时，弹出如下界面供我们选择：</p>
<img src="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/img6.png" class title="This is an example image">

<p>我们可以总结如下：</p>
<ul>
<li>当Intent匹配成功的组件有多个时，显示优先级高的组件，如果优先级相同，显示列表让用户自己选择</li>
<li>优先级从-1000至1000，并且其中一个必须为负的才有效<br>注：系统默认的浏览器并没有做出优先级声明，其优先级默认为正数。</li>
</ul>
<p>优先级的配置如下：</p>
<p>在清单文件中修改对SecondAcivity的声明，即增加一行代码，通过来android:priority设置优先级，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">            android:name=&quot;.SecondActivity&quot;&gt;</span><br><span class="line">            &lt;intent-filter android:priority=&quot;-1&quot;&gt;</span><br><span class="line">                 &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;</span><br><span class="line">                 &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;</span><br><span class="line">                 &lt;data android:scheme=&quot;http&quot; android:host=&quot;www.baidu.com&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br></pre></td></tr></table></figure>
<p>注：</p>
<p>Data属性的声明中要指定访问数据的Uri和MIME类型。可以在<data>元素中通过一些属性来设置：</data></p>
<p>android:scheme、android:path、android:port、android:mimeType、android:host等，通过这些属性来对应一个典型的Uri格式scheme:&#x2F;&#x2F;host:port&#x2F;path。例如：<a target="_blank" rel="noopener" href="http://www.google.com./">http://www.google.com。</a></p>
<h3 id="七-type（数据类型）：对于data范例的描写"><a href="#七-type（数据类型）：对于data范例的描写" class="headerlink" title="七.type（数据类型）：对于data范例的描写"></a>七.type（数据类型）：对于data范例的描写</h3><p>如果Intent对象中既包含Uri又包含Type，那么，在<intent-filter>中也必须二者都包含才能通过测试。</intent-filter></p>
<p>Type属性用于明确指定Data属性的数据类型或MIME类型，但是通常来说，当Intent不指定Data属性时，Type属性才会起作用，否则Android系统将会根据Data属性值来分析数据的类型，所以无需指定Type属性。</p>
<p>data和type属性一般只需要一个，通过setData方法会把type属性设置为null，相反设置setType方法会把data设置为null，如果想要两个属性同时设置，要使用Intent.setDataAndType()方法。</p>
<p>【任务】：data+type属性的使用<br>【实例】：播放指定路径的mp3文件。</p>
<p>具体如下：</p>
<p>新建工程文件smyh006_Intent02，MainActivity.java中按钮监听事件部分的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">button.setOnClickListener(new OnClickListener()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Intent intent = new Intent();</span><br><span class="line">                intent.setAction(Intent.ACTION_VIEW);</span><br><span class="line">                Uri data = Uri.parse(&quot;file:///storage/sdcard0/平凡之路.mp3&quot;);</span><br><span class="line">                //设置data+type属性</span><br><span class="line">                intent.setDataAndType(data, &quot;audio/mp3&quot;); //方法：Intent android.content.Intent.setDataAndType(Uri data, String type)</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>代码解释：</p>
<p>第6行：”file:&#x2F;&#x2F;“表示查找文件，后面再加上我的小米手机存储卡的路径：&#x2F;storage&#x2F;sdcard0，再加上具体歌曲的路径。</p>
<p>第8行：设置data+type属性　　</p>
<p>运行后，当点击按钮时，效果如下：</p>
<img src="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/img7.png" class title="This is an example image">

<h3 id="八-extras（扩展信息）：扩展信息"><a href="#八-extras（扩展信息）：扩展信息" class="headerlink" title="八.extras（扩展信息）：扩展信息"></a>八.extras（扩展信息）：扩展信息</h3><p>是其它所有附加信息的集合。使用extras可以为组件提供扩展信息，比如，如果要执行“发送电子邮件”这个</p>
<p>动作，可以将电子邮件的标题、正文等保存在extras里，传给电子邮件发送组件。</p>
<h3 id="九-Flags（标志位）：期望这个意图的运行模式"><a href="#九-Flags（标志位）：期望这个意图的运行模式" class="headerlink" title="九.Flags（标志位）：期望这个意图的运行模式"></a>九.Flags（标志位）：期望这个意图的运行模式</h3><p>一个程序启动后系统会为这个程序分配一个task供其使用，另外同一个task里面可以拥有不同应用程序的activity。那么，同一个程序能不能拥有多个task？这就涉及到加载activity的启动模式，这个需要单独讲一下。</p>
<p>注：android中一组逻辑上在一起的activity被叫做task，自己认为可以理解成一个activity堆栈。</p>
<h3 id="十-Activity的启动模式："><a href="#十-Activity的启动模式：" class="headerlink" title="十.Activity的启动模式："></a>十.Activity的启动模式：</h3><p><a target="_blank" rel="noopener" href="https://freedomyouth.gitee.io/2021/03/08//Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/">Activity基础篇-启动模式详解</a></p>
<p>其实我们不在清单文件中设置，只在代码中通过flag来设置也是可以的，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(MainActivity.this,SecondActivity.class);</span><br><span class="line">//相当于singleTask</span><br><span class="line">intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(MainActivity.this,SecondActivity.class);</span><br><span class="line">//相当于singleTop</span><br><span class="line">intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>

<h3 id="十一-Intent的常见应用："><a href="#十一-Intent的常见应用：" class="headerlink" title="十一.Intent的常见应用："></a>十一.Intent的常见应用：</h3><ol>
<li><p>打开指定网页：（直接复制的上面的代码）<br>MainActivity.java中，监听器部分的核心代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> button1.setOnClickListener(new OnClickListener() &#123;            </span><br><span class="line">     @Override</span><br><span class="line">     public void onClick(View v) &#123;</span><br><span class="line">         Intent intent = new Intent();</span><br><span class="line">         intent.setAction(Intent.ACTION_VIEW);//方法：android.content.Intent.Intent(String action)</span><br><span class="line">         Uri data = Uri.parse(&quot;http://www.baidu.com&quot;);</span><br><span class="line">         intent.setData(data);                </span><br><span class="line">         startActivity(intent);        </span><br><span class="line">     &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当然，上方代码也可以简写成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new OnClickListener() &#123;            </span><br><span class="line">          @Override</span><br><span class="line">          public void onClick(View v) &#123;</span><br><span class="line">              Intent intent = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">              intent.setData(Uri.parse(&quot;http://www.baidu.com&quot;));                </span><br><span class="line">              startActivity(intent);        </span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>
<p>第4行代码：指定了Intent的action是 Intent.ACTION_VIEW，表示查看的意思，这是一个Android系统内置的动作；<br>第5行代码：通过Uri.parse()方法，将一个网址字符串解析成一个Uri对象，再调用intent的setData()方法将这个Uri对象传递进去。<br>或者可以写成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new OnClickListener() &#123;            </span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        Uri uri = Uri.parse(&quot;http://www.baidu.com&quot;);</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_VIEW,uri);//方法： android.content.Intent.Intent(String action, Uri uri)        </span><br><span class="line">        startActivity(intent);        </span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>电话：</p>
<ul>
<li>【方式一】打开拨打电话的界面：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(Intent.ACTION_DIAL);</span><br><span class="line">intent.setData(Uri.parse(&quot;tel:10086&quot;));</span><br><span class="line">startActivity(intent); </span><br></pre></td></tr></table></figure>
运行程序后，点击按钮，显示如下界面：<img src="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/img8.png" class title="This is an example image"></li>
<li>【方式二】直接拨打电话：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(Intent.ACTION_CALL);</span><br><span class="line">intent.setData(Uri.parse(&quot;tel:10086&quot;));</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
要使用这个功能必须在配置文件中加入权限：（加一行代码）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-sdk</span><br><span class="line">    android:minSdkVersion=&quot;8&quot;</span><br><span class="line">    android:targetSdkVersion=&quot;16&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.CALL_PHONE&quot;/&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>发送短信：<br>【方式一】打开发送短信的界面：action+type</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">intent.setType(&quot;vnd.android-dir/mms-sms&quot;);</span><br><span class="line">intent.putExtra(&quot;sms_body&quot;, &quot;具体短信内容&quot;); //&quot;sms_body&quot;为固定内容</span><br><span class="line">startActivity(intent); </span><br></pre></td></tr></table></figure>
<p>【方式二】打开发短信的界面(同时指定电话号码)：action+data</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(Intent.ACTION_SENDTO);</span><br><span class="line">intent.setData(Uri.parse(&quot;smsto:18780260012&quot;));</span><br><span class="line">intent.putExtra(&quot;sms_body&quot;, &quot;具体短信内容&quot;); //&quot;sms_body&quot;为固定内容        </span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
</li>
<li><p>播放指定路径音乐：action+data+type</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> Intent intent = new Intent(Intent.ACTION_VIEW);</span><br><span class="line"> Uri uri = Uri.parse(&quot;file:///storage/sdcard0/平凡之路.mp3&quot;); ////路径也可以写成：&quot;/storage/sdcard0/平凡之路.mp3&quot;</span><br><span class="line">intent.setDataAndType(uri, &quot;audio/mp3&quot;); //方法：Intent android.content.Intent.setDataAndType(Uri data, String type)</span><br><span class="line"> startActivity(intent);</span><br></pre></td></tr></table></figure>
</li>
<li><p>卸载程序：action+data（例如点击按钮，卸载某个应用程序，根据包名来识别）<br>注：无论是安装还是卸载，应用程序是根据包名package来识别的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(Intent.ACTION_DELETE);</span><br><span class="line">Uri data = Uri.parse(&quot;package:com.example.smyh006intent01&quot;);</span><br><span class="line">intent.setData(data);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装程序：action+data+type</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">Uri data = Uri.fromFile(new File(&quot;/storage/sdcard0/AndroidTest/smyh006_Intent01.apk&quot;));    //路径不能写成：&quot;file:///storage/sdcard0/···&quot;</span><br><span class="line">intent.setDataAndType(data, &quot;application/vnd.android.package-archive&quot;);  //Type的字符串为固定内容</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
<p>注：第2行的路径不能写成：”file:&#x2F;&#x2F;&#x2F;storage&#x2F;sdcard0&#x2F;···”，不然报错如下：</p>
<img src="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/img9.png" class title="This is an example image">
<p>疑问：通过下面的这种方式安装程序，运行时为什么会出错呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//通过指定的action来安装程序</span><br><span class="line">public void installClickTwo(View view)&#123;</span><br><span class="line">    Intent intent = new Intent(Intent.ACTION_PACKAGE_ADDED);</span><br><span class="line">    Uri data = Uri.fromFile(new File(&quot;/storage/sdcard0/AndroidTest/smyh006_Intent01.apk&quot;));    //路径不能写成：&quot;file:///storage/sdcard0/···&quot;</span><br><span class="line">    intent.setData(data);</span><br><span class="line">    startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/itemuse/XTester/tree/master/intent">总结代码</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">package com.example.m06intent01;</span><br><span class="line">import java.io.File;</span><br><span class="line">import android.app.Activity;</span><br><span class="line">import android.content.Intent;</span><br><span class="line">import android.net.Uri;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.view.Menu;</span><br><span class="line">import android.view.View;</span><br><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line">    //打开指定网页</span><br><span class="line">    public void browsePageClick(View view)&#123;</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">        intent.setData(Uri.parse(&quot;http://www.baidu.com/&quot;));</span><br><span class="line">        startActivity(intent);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //打开拨号面板</span><br><span class="line">    public void openDialPageClick(View view)&#123;</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_DIAL);</span><br><span class="line">        intent.setData(Uri.parse(&quot;tel:10086&quot;));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //直接拨打指定号码</span><br><span class="line">    public void dialPhoneClick(View view)&#123;</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_CALL);</span><br><span class="line">        intent.setData(Uri.parse(&quot;tel:10086&quot;));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //打开发短信的界面:action+type</span><br><span class="line">    public void openMsgPageClick(View view)&#123;</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">        intent.setType(&quot;vnd.android-dir/mms-sms&quot;);</span><br><span class="line">        intent.putExtra(&quot;sms_body&quot;, &quot;具体短信内容&quot;); //&quot;sms_body&quot;为固定内容</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //打开发短信的界面(指定电话号码):action+data</span><br><span class="line">    public void sendMsgClick(View view)&#123;</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_SENDTO);</span><br><span class="line">        intent.setData(Uri.parse(&quot;smsto:18780260012&quot;));</span><br><span class="line">        intent.putExtra(&quot;sms_body&quot;, &quot;具体短信内容&quot;); //&quot;sms_body&quot;为固定内容</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //播放指定路径音乐</span><br><span class="line">    public void playMusicClick(View view)&#123;</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">        Uri uri = Uri.parse(&quot;file:///storage/sdcard0/平凡之路.mp3&quot;);  //路径也可以写成：&quot;/storage/sdcard0/平凡之路.mp3&quot;</span><br><span class="line">        intent.setDataAndType(uri, &quot;audio/mp3&quot;); //方法：Intent android.content.Intent.setDataAndType(Uri data, String type)</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //卸载某个应用程序，根据包名来识别</span><br><span class="line">    public void uninstallClick(View view)&#123;</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_DELETE);</span><br><span class="line">        Uri data = Uri.parse(&quot;package:com.example.smyh006intent01&quot;);</span><br><span class="line">        intent.setData(data);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //安装某个应用程序，根据apk的文件名来识别</span><br><span class="line">    public void installClick(View view)&#123;</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">        Uri data = Uri.fromFile(new File(&quot;/storage/sdcard0/AndroidTest/smyh006_Intent01.apk&quot;));    //路径不能写成：&quot;file:///storage/sdcard0/···&quot;</span><br><span class="line">        intent.setDataAndType(data, &quot;application/vnd.android.package-archive&quot;);  //Type的字符串为固定内容</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onCreateOptionsMenu(Menu menu) &#123;</span><br><span class="line">        // Inflate the menu; this adds items to the action bar if it is present.</span><br><span class="line">        getMenuInflater().inflate(R.menu.main, menu);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2020/05/25/2021-03-08-Intent%E5%9F%BA%E7%A1%80/img10.png" class title="This is an example image">


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="项勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自由侠">
      <meta itemprop="description" content="万里苍穹，星辰大海">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 自由侠">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Activity基础篇-启动模式详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-19 10:39:40" itemprop="dateCreated datePublished" datetime="2020-05-19T10:39:40+08:00">2020-05-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-30 22:01:19" itemprop="dateModified" datetime="2023-01-30T22:01:19+08:00">2023-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Activity基础篇-启动模式详解" href="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::1e97ee17877b74cbc6366aa8d9f9969c" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一-启动模式"><a href="#一-启动模式" class="headerlink" title="一.启动模式"></a>一.启动模式</h3><img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/640.png" class title="This is an example image">

<p>Activity 一共有四种 launchMode ：<strong>standard</strong> 、<strong>singleTop</strong> 、<strong>singleTask</strong> 、<strong>singleInstance</strong> 。</p>
<img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/641.png" class title="This is an example image">

<p><strong>Standard 模式（默认模式）</strong></p>
<ol>
<li>说明：每次启动一个 Activity 都会又一次创建一个新的实例入栈，无论这个实例是否存在。</li>
<li>生命周期：每次被创建的实例 Activity 的生命周期符合典型情况，它的 onCreate 、onStart 、onResume 都会被调用。</li>
<li>举例：此时 Activity 栈中以此有 A 、B 、C 三个 Activity ，此时C处于栈顶，启动模式为 Standard 模式。若在 C Activity 中加入点击事件，须要跳转到还有一个同类型的 C Activity 。结果是还有一个 C Activity 进入栈中，成为栈顶。</li>
</ol>
<img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/642.png" class title="This is an example image">

<p><strong>SingleTop 模式（栈顶复用模式）</strong></p>
<ol>
<li>说明：分两种处理情况：须要创建的 Activity 已经处于栈顶时，此时会直接复用栈顶的 Activity 。不会再创建新的 Activity ；若须要创建的 Activity 不处于栈顶，此时会又一次创建一个新的 Activity 入栈，同 Standard 模式一样。</li>
<li>生命周期：若情况一中栈顶的 Activity 被直接复用时，它的 onCreate 、onStart 不会被系统调用，由于它并没有发生改变。可是一个新的方法 onNewIntent 会被回调（ Activity 被正常创建时不会回调此方法）。</li>
<li>举例：此时 Activity 栈中以此有 A 、B 、C 三个 Activity ，此时 C 处于栈顶，启动模式为 SingleTop 模式。情况一：在 C Activity 中加入点击事件，须要跳转到还有一个同类型的 C Activity 。结果是直接复用栈顶的 C Activity。情况二：在 C Activity 中加入点击事件，须要跳转到还有一个 A Activity。结果是创建一个新的 Activity 入栈。成为栈顶。</li>
</ol>
<img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/643.png" class title="This is an example image">

<p><strong>SingleTask 模式（栈内复用模式）</strong></p>
<ol>
<li>说明：若须要创建的 Activity 已经处于栈中时，此时不会创建新的 Activity ，而是将存在栈中的 Activity 上面的其他 Activity 所有销毁，使它成为栈顶。</li>
<li>如果是在别的应用程序中启动它，则会新建一个 task ，并在该task中启动这个 Activity ，singleTask 允许别的 Activity 与其在一个 task 中共存，也就是说，如果我在这个 singleTask 的实例中再打开新的 Activity ，这个新的 Activity 还是会在 singleTask 的实例的 task 中。</li>
<li>生命周期：同 SingleTop 模式中的情况一同样。仅仅会又一次回调 Activity 中的 onNewIntent 方法</li>
<li>举例：此时 Activity 栈中以此有 A 、B 、C 三个 Activity 。此时 C 处于栈顶，启动模式为 SingleTask 模式。情况一：在 C Activity 中加入点击事件，须要跳转到还有一个同类型的 C Activity 。结果是直接用栈顶的 C Activity 。情况二：在 C Activity 中加入点击事件，须要跳转到还有一个 A Activity 。结果是将 A Activity 上面的 B 、C 所有销毁，使 A Activity 成为栈顶。</li>
</ol>
<img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/644.png" class title="This is an example image">

<p><strong>SingleInstance 模式（单实例模式）</strong></p>
<ol>
<li>说明：SingleInstance 比较特殊，是全局单例模式，是一种加强的 SingleTask 模式。它除了具有它所有特性外，还加强了一点：只有一个实例，并且这个实例独立运行在一个 task 中，这个 task 只有这个实例，不允许有别的 Activity 存在。</li>
<li>这个经常使用于系统中的应用，比如 Launch 、锁屏键的应用等等，整个系统中仅仅有一个！所以在我们的应用中一般不会用到。了解就可以。</li>
<li>举例：比方 A Activity 是该模式，启动 A 后。系统会为它创建一个单独的任务栈，由于栈内复用的特性。兴许的请求均不会创建新的 Activity ，除非这个独特的任务栈被系统销毁。</li>
</ol>
<h3 id="二-启动模式的使用方式"><a href="#二-启动模式的使用方式" class="headerlink" title="二.启动模式的使用方式"></a>二.启动模式的使用方式</h3><img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/645.png" class title="This is an example image">

<p>在 Manifest.xml 中指定 Activity 启动模式</p>
<ol>
<li>一种静态的指定方法</li>
<li>在 Manifest.xml 文件里声明 Activity 的同一时候指定它的启动模式</li>
<li>这样在代码中跳转时会依照指定的模式来创建 Activity 。</li>
</ol>
<p>启动 Activity 时。在 Intent 中指定启动模式去创建 Activity</p>
<ol>
<li>一种动态的启动模式</li>
<li>在 new 一个 Intent 后</li>
<li>通过 Intent 的 addFlags 方法去动态指定一个启动模式。</li>
</ol>
<p>注意：以上两种方式都能够为 Activity 指定启动模式，可是二者还是有差别的。</p>
<ol>
<li>优先级：动态指定方式即另外一种比第一种优先级要高，若两者同一时候存在，以另外一种方式为准。</li>
<li>限定范围：第一种方式无法为 Activity 直接指定 FLAG_ACTIVITY_CLEAR_TOP 标识，另外一种方式无法为 Activity 指定 singleInstance 模式。</li>
</ol>
<h3 id="三-启动模式的实际应用场景"><a href="#三-启动模式的实际应用场景" class="headerlink" title="三.启动模式的实际应用场景"></a>三.启动模式的实际应用场景</h3><p>这四种模式中的 Standard 模式是最普通的一种，没有什么特别注意。而 SingleInstance 模式是整个系统的单例模式，在我们的应用中一般不会应用到。所以，这里就具体解说  SingleTop 和 SingleTask 模式的运用场景：</p>
<img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/646.png" class title="This is an example image">
<p><strong>SingleTask 模式的运用场景</strong></p>
<ol>
<li>最常见的应用场景就是保持我们应用开启后仅仅有一个 Activity 的实例。</li>
<li>最典型的样例就是应用中展示的主页（ Home 页）。</li>
<li>假设用户在主页跳转到其他页面，运行多次操作后想返回到主页，假设不使用 SingleTask 模式，在点击返回的过程中会多次看到主页，这明显就是设计不合理了。</li>
</ol>
<p><strong>SingleTop 模式的运用场景</strong></p>
<ol>
<li>假设你在当前的 Activity 中又要启动同类型的 Activity</li>
<li>此时建议将此类型 Activity 的启动模式指定为 SingleTop ，能够降低Activity的创建，节省内存！</li>
</ol>
<p>注意：复用 Activity 时的生命周期回调</p>
<ol>
<li>这里还须要考虑一个 Activity 跳转时携带页面參数的问题。</li>
<li>由于当一个 Activity 设置了 SingleTop 或者 SingleTask 模式后，跳转此 Activity 出现复用原有 Activity 的情况时，此 Activity 的 onCreate 方法将不会再次运行。onCreate 方法仅仅会在第一次创建 Activity 时被运行。</li>
<li>而一般 onCreate 方法中会进行该页面的数据初始化、UI 初始化，假设页面的展示数据无关页面跳转传递的參数，则不必操心此问题</li>
<li>若页面展示的数据就是通过 getInten() 方法来获取，那么问题就会出现：getInten() 获取的一直都是老数据，根本无法接收跳转时传送的新数据！</li>
</ol>
<p>以下，通过一个样例来具体解释：</p>
<img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/647.png" class title="This is an example image">

<p>以上代码中的 CourseDetailActivity 在配置文件里设置了启动模式是 SingleTop 模式，依据上面启动模式的介绍可得知，当 CourseDetailActivity 处于栈顶时。</p>
<p>再次跳转页面到 CourseDetailActivity 时会直接复用原有的 Activity ，并且此页面须要展示的数据是从 getIntent() 方法得来，可是 initData() 方法不会再次被调用，此时页面就无法显示新的数据。</p>
<p>当然这样的情况系统早就为我们想过了，这时我们须要另外一个回调 onNewIntent（Intent intent）方法。此方法会传入最新的 intent ，这样我们就能够解决上述问题。这里建议的方法是又一次去 setIntent 。然后又一次去初始化数据和 UI 。</p>
<p>代码例如以下所看到的：</p>
<img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/648.png" class title="This is an example image">

<p>这样，在一个页面中能够反复跳转并显示不同的内容。</p>
<h3 id="四-快速启动一个-Activity"><a href="#四-快速启动一个-Activity" class="headerlink" title="四.快速启动一个 Activity"></a>四.快速启动一个 Activity</h3><img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/649.png" class title="This is an example image">

<p>这个问题其实也是比较简单的，就是不要在 Activity 的 onCreate 方法中执行过多繁重的操作，并且在 onPasue 方法中同样不能做过多的耗时操作。</p>
<h3 id="五-Activity-的-Flags"><a href="#五-Activity-的-Flags" class="headerlink" title="五.Activity 的 Flags"></a>五.Activity 的 Flags</h3><img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/650.png" class title="This is an example image">

<ul>
<li>标记位既能够设定Activity的启动模式，如同上面介绍的，在动态指定启动模式，比方 <strong>FLAG_ACTIVITY_NEW_TASK</strong> 和 <strong>FLAG_ACTIVITY_SINGLE_TOP</strong> 等。它还能够影响 Activity 的运行状态 ，比方 <strong>FLAG_ACTIVITY_CLEAN_TOP</strong> 和 <strong>FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS</strong> 等。</li>
<li>以下介绍几个基本的标记位，切勿死记，理解几个就可以，须要时再查官方文档。</li>
</ul>
<img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/651.png" class title="This is an example image">

<p><strong>FLAG_ACTIVITY_NEW_TASK</strong></p>
<p>作用是为 Activity 指定 “SingleTask” 启动模式。跟在 AndroidMainfest.xml 指定效果同样</p>
<p><strong>FLAG_ACTIVITY_SINGLE_TOP</strong></p>
<p>作用是为 Activity 指定 “SingleTop” 启动模式，跟在 AndroidMainfest.xml 指定效果同样。</p>
<p><strong>FLAG_ACTIVITY_CLEAN_TOP</strong></p>
<ol>
<li>具有此标记位的 Activity ，启动时会将与该 Activity 在同一任务栈的其他 Activity 出栈。</li>
<li>一般与 SingleTask 启动模式一起出现。</li>
<li>它会完毕 SingleTask 的作用。</li>
<li>但事实上 SingleTask 启动模式默认具有此标记位的作用</li>
</ol>
<p><strong>FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS</strong></p>
<ol>
<li>具有此标记位的 Activity 不会出如今历史 Activity 的列表中</li>
<li>使用场景：当某些情况下我们不希望用户通过历史列表回到 Activity 时，此标记位便体现了它的效果。</li>
<li>它等同于在 xml 中指定 Activity 的属性.</li>
</ol>
<h3 id="六-onNewInstent-方法什么时候执行"><a href="#六-onNewInstent-方法什么时候执行" class="headerlink" title="六.onNewInstent()方法什么时候执行"></a>六.onNewInstent()方法什么时候执行</h3><img src="/2020/05/19/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/652.png" class title="This is an example image">

<p>这个是启动模式中的了，当此 Activity 的实例已经存在，并且此时的启动模式为 SingleTask 和 SingleInstance ，另外当这个实例位于栈顶且启动模式为 SingleTop 时也会触发 onNewInstent()。</p>
<h3 id="七-启动流程"><a href="#七-启动流程" class="headerlink" title="七.启动流程"></a>七.启动流程</h3><ul>
<li>注意！这里并不是要回答 Activity 的生命周期！</li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/entry/58f5b68e61ff4b005807ab47">3 分钟看懂 Activity 启动流程</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/18/2021-03-07-Activity%E5%9F%BA%E7%A1%80%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="项勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自由侠">
      <meta itemprop="description" content="万里苍穹，星辰大海">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 自由侠">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/18/2021-03-07-Activity%E5%9F%BA%E7%A1%80%E7%AF%87/" class="post-title-link" itemprop="url">Activity基础篇</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-18 11:37:55" itemprop="dateCreated datePublished" datetime="2020-05-18T11:37:55+08:00">2020-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-30 21:57:03" itemprop="dateModified" datetime="2023-01-30T21:57:03+08:00">2023-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Activity基础篇" href="/2020/05/18/2021-03-07-Activity%E5%9F%BA%E7%A1%80%E7%AF%87/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::e50b73d278cf4aef578f32a690a6d129" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一-什么是Activity"><a href="#一-什么是Activity" class="headerlink" title="一.什么是Activity"></a>一.什么是Activity</h3><p>Activity是Android应用程序核心组件中最基本的一个，是用户和程序交互的窗口，一个activity通常对应一个单独的视图，一个APP由一个或者多个activity构成，activity用于显示信息给用户，并且之间可以相互进行跳转，activity之间的跳转有返回值。</p>
<p>每一个activity都被定义为一个独立的类，他继承了Android中的android.app.Activity，在Activity类中将使用setContentView方法来显示由视图控件组成的用户界面，并对用户通过这些视图控件所出发的时间做出响应。</p>
<h3 id="二-activity的四种状态"><a href="#二-activity的四种状态" class="headerlink" title="二.activity的四种状态"></a>二.activity的四种状态</h3><ol>
<li><p>激活状态，此时activity运行在屏幕前台</p>
</li>
<li><p>暂停状态，此时activity失去焦点，但是用户仍然可以看到（例如这个activity上遮盖了一个透明的或者非全屏的activity）</p>
</li>
<li><p>停止状态，此时activity被其他activity完全覆盖</p>
</li>
<li><p>销毁状态，此时activity将会被系统清理出内存</p>
</li>
</ol>
<h3 id="三-activity的回调函数"><a href="#三-activity的回调函数" class="headerlink" title="三.activity的回调函数"></a>三.activity的回调函数</h3><p>android系统根据生命周期的不同阶段唤起对应的回调函数来执行代码，从启动到销毁一个activity有着一套有序的回调函数。</p>
<ul>
<li><p>onCreate()<br>创建，activity初次创建时被调用，该方法中一般进行一些静态设置。</p>
</li>
<li><p>onStart()<br>运行，activity对用户即将可见的时候调用</p>
</li>
<li><p>onResume()<br>获取焦点，当activity将要与用户进行交互时候调用</p>
</li>
<li><p>onPause()<br>失去焦点，当系统要启动一个其他的activity时调用（在其他activity显示之前调用）</p>
</li>
<li><p>onStop()<br>暂停，当另外一个activity恢复并遮盖当前activity，导致其对用户不可见时调用。</p>
</li>
<li><p>onDestroy()<br>销毁，在activity被销毁前所调用的最后一个方法</p>
</li>
<li><p>onRestart()<br>重新启动</p>
</li>
</ul>
<p>这七个方法贯穿整个activity的生命周期。<br>一张图来表示</p>
<img src="/2020/05/18/2021-03-07-Activity%E5%9F%BA%E7%A1%80%E7%AF%87/img1.jpg" class title="This is an example image">

<h3 id="四-activity的启动与销毁"><a href="#四-activity的启动与销毁" class="headerlink" title="四.activity的启动与销毁"></a>四.activity的启动与销毁</h3><p>大多数的APP都包含多个activity，不论这些activity是主activity还是为了响应用户行为而新建的，系统都会调用新的activity实例中的onCreate()方法，通常情况下我们会在onCreate()方法内声明一些UI元素或者定义一些成员变量等基本操作，但onCreate()方法中尽量少做事情，以免程序启动太久都看不到界面。</p>
<p>一旦onCreate()操作结束，系统会立即执行这个activity的onStart()方法和onResume()方法，最终使得activity停留在Resumed状态，直到一些因素发生变化才会改变这个状态，例如切换到另外一个activity或者退出程序。</p>
<p>一旦我们退出软件，系统会执行activity的onDestroy()方法，将activity从系统中完全移除，我们通常是在执行了 onPause() and onStop() 之后再调用onDestroy() 。</p>
<h3 id="五-activity的暂停与恢复"><a href="#五-activity的暂停与恢复" class="headerlink" title="五.activity的暂停与恢复"></a>五.activity的暂停与恢复</h3><p>在使用app的过程中，运行的activity经常会被其他组件挡住，例如提示电量不足的提示框等， activity可见但不可操作，这个时候activity就会调用onPause()方法进去Pause状态，这个方法会停止当前activity进行的操作，并保存那些有可能需要长期保存的信息，如果用户从暂停状态返回到activity，系统会恢复那些数据并执行onResume()方法。</p>
<h3 id="六-activity的停止与重启"><a href="#六-activity的停止与重启" class="headerlink" title="六.activity的停止与重启"></a>六.activity的停止与重启</h3><p>当我们从APP-A切换到APP-B之后，APP-A会调用onStop()方法，在onStop()方法中我们一般释放一些不再需要的资源</p>
<p>当我们从stop状态回到前台时候，会调用onRestart()方法，系统再调用onStart()方法，</p>
<h3 id="七-activity的生命周期"><a href="#七-activity的生命周期" class="headerlink" title="七.activity的生命周期"></a>七.activity的生命周期</h3><p>activity的生命周期可以根据不同的标准分为完整生命周期、可见生命周期和前台生命周期。</p>
<p>从activity最初调用onCreate()方法到最终调用onDestroy()方法的整个过程称之为完整生命周期，在onCreate()方法中设置全局状态，在onDestroy()方法中释放所有资源。</p>
<p>从activity调用onStart()方法到调用对应的onStop()方法的过程称之为可见生命周期，在这个过程中，activity都是对用户可见的（但不一定可以操作）</p>
<p>从activity调用onResume()开始到调用onPause()的整个过程称之为前台生命周期，这段时间内这个activity处于其他所有activity的前面，用户可以与之进行交互。</p>
<h3 id="八-演示"><a href="#八-演示" class="headerlink" title="八.演示"></a>八.演示</h3><p>我们创建一个android工程，然后重写那些方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">import android.app.Activity;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.view.Menu;</span><br><span class="line">import android.view.MenuItem;</span><br><span class="line"></span><br><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        System.out.println(&quot;执行onCreate...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onStart() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onStart();</span><br><span class="line">        System.out.println(&quot;执行onStart...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onResume() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onResume();</span><br><span class="line">        System.out.println(&quot;执行onResume...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onPause() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onPause();</span><br><span class="line">        System.out.println(&quot;执行onPause...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onStop() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onStop();</span><br><span class="line">        System.out.println(&quot;执行onStop...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDestroy() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onDestroy();</span><br><span class="line">        System.out.println(&quot;执行onDestroy...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onRestart() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onRestart();</span><br><span class="line">        System.out.println(&quot;执行onRestart...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>　　在模拟器中运行，查看日志</p>
<img src="/2020/05/18/2021-03-07-Activity%E5%9F%BA%E7%A1%80%E7%AF%87/img2.jpg" class title="This is an example image">

<p>然后我们按home返回到桌面</p>
<img src="/2020/05/18/2021-03-07-Activity%E5%9F%BA%E7%A1%80%E7%AF%87/img3.jpg" class title="This is an example image">

<p>按菜单键，选择回到刚才的界面</p>
<img src="/2020/05/18/2021-03-07-Activity%E5%9F%BA%E7%A1%80%E7%AF%87/img4.jpg" class title="This is an example image">

<p>按返回键退出activity</p>
<img src="/2020/05/18/2021-03-07-Activity%E5%9F%BA%E7%A1%80%E7%AF%87/img5.jpg" class title="This is an example image">

<h3 id="九-如何创建一个activity"><a href="#九-如何创建一个activity" class="headerlink" title="九.如何创建一个activity"></a>九.如何创建一个activity</h3><p>新建一个activity步骤如下</p>
<ol>
<li>在src中新建一个类继承activity，并重写其onCreate()方法<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MyActivity.java</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import android.app.Activity;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line"></span><br><span class="line">public class MyActivity extends Activity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.my_activity_layout);// 使用setContentView方法显示一个布局文件</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在res—layout中创建一个布局文件，用以显示界面内容<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">my_activity_layout.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;这是一个TextView&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure></li>
<li>在AndroidManiFest.xml中注册这个activity<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">AndroidManiFest.xml</span><br><span class="line"></span><br><span class="line">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    package=&quot;com.example.activitytest&quot;</span><br><span class="line">    android:versionCode=&quot;1&quot;</span><br><span class="line">    android:versionName=&quot;1.0&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;uses-sdk</span><br><span class="line">        android:minSdkVersion=&quot;19&quot;</span><br><span class="line">        android:targetSdkVersion=&quot;19&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;application</span><br><span class="line">        android:allowBackup=&quot;true&quot;</span><br><span class="line">        android:icon=&quot;@drawable/ic_launcher&quot;</span><br><span class="line">        android:label=&quot;@string/app_name&quot;</span><br><span class="line">        android:theme=&quot;@style/AppTheme&quot; &gt;</span><br><span class="line">        &lt;!-- 注册一个activity --&gt;</span><br><span class="line">        &lt;activity android:name=&quot;com.example.activitytest.MyActivity&quot; &gt;</span><br><span class="line">   &lt;!-- 如果是主activity，需要添加如下过滤器来告诉系统这是入口 --&gt;</span><br><span class="line">   &lt;intent-filter&gt;</span><br><span class="line">       &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</span><br><span class="line"></span><br><span class="line">       &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</span><br><span class="line">   &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>　　这样，一个activity就创建成功了。</p>
<h3 id="十-如何关闭一个activity"><a href="#十-如何关闭一个activity" class="headerlink" title="十.如何关闭一个activity"></a>十.如何关闭一个activity</h3><p>只要按下返回键就可以销毁当前activity，但是假如我们希望通过代码方式来销毁activity，可以使用activity类提供的finish()方法来实现。</p>
<p>修改一下上面的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">MyActivity.java</span><br><span class="line"></span><br><span class="line">import android.app.Activity;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.View.OnClickListener;</span><br><span class="line">import android.widget.Button;</span><br><span class="line"></span><br><span class="line">public class MyActivity extends Activity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.my_activity_layout);// 使用setContentView方法显示一个布局文件</span><br><span class="line"></span><br><span class="line">        Button button = (Button) findViewById(R.id.finishActivity); // 找到这个按钮</span><br><span class="line">        button.setOnClickListener(new OnClickListener() &#123; // 给这个按钮添加一个点击事件</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public void onClick(View v) &#123;</span><br><span class="line">       finish(); // 当点击按钮时，销毁这个activity</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDestroy() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        super.onDestroy();</span><br><span class="line">        System.out.println(&quot;onDestroy方法被调用&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;这是一个TextView&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/finishActivity&quot;</span><br><span class="line">        android:layout_width=&quot;fill_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;关闭这个activity&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>这时候运行该程序，点击按钮，这个activity就会被关闭。</p>
<h3 id="十一-finish-和onDestroy-有什么区别"><a href="#十一-finish-和onDestroy-有什么区别" class="headerlink" title="十一.finish()和onDestroy()有什么区别"></a>十一.finish()和onDestroy()有什么区别</h3><p>从上面的代码运行结果来看，控制台上输出了“onDestroy方法被调用”，由此可见，在执行finish()时执行了onDestroy()方法。</p>
<p>实际上他们的区别在于 onDestroy()是生命周期方法，是你的Activity结束的时候由Android系统调用的，你不能直接调用onDestroy()来结束你的Activity,一般做法是调用finish()。</p>
<h3 id="十二-四种LaunchMode"><a href="#十二-四种LaunchMode" class="headerlink" title="十二.四种LaunchMode"></a>十二.四种LaunchMode</h3><p>清单配置文件中,可使用android:launchMode&#x3D;”standard|singleInstance|single Task|singleTop”四种模式来控制Acivity任务栈。<br>单独整理一篇<a target="_blank" rel="noopener" href="https://freedomyouth.gitee.io/2021/03/08//Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/">Activity基础篇-启动模式详解</a><br>史上最详细扔物线讲解<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1CA41177Se">Android 面试黑洞——当我按下 Home 键再切回来，会发生什么？</a>  </p>
<h3 id="十三-保存数据"><a href="#十三-保存数据" class="headerlink" title="十三.保存数据"></a>十三.保存数据</h3><p>单独整理一篇<a target="_blank" rel="noopener" href="https://freedomyouth.gitee.io/2017/12/21/Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/">Activity基础篇-保存数据</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/07/21/2021-03-06-%E8%A7%A3%E8%AF%BB%E9%97%B9%E9%92%9F%E4%BB%A3%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="项勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自由侠">
      <meta itemprop="description" content="万里苍穹，星辰大海">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 自由侠">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/07/21/2021-03-06-%E8%A7%A3%E8%AF%BB%E9%97%B9%E9%92%9F%E4%BB%A3%E7%A0%81/" class="post-title-link" itemprop="url">解读闹钟代码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-07-21 17:47:35" itemprop="dateCreated datePublished" datetime="2018-07-21T17:47:35+08:00">2018-07-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-30 21:56:37" itemprop="dateModified" datetime="2023-01-30T21:56:37+08:00">2023-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="解读闹钟代码" href="/2018/07/21/2021-03-06-%E8%A7%A3%E8%AF%BB%E9%97%B9%E9%92%9F%E4%BB%A3%E7%A0%81/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::5a9e1117e38b00220a662082dfbc3a4c" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一-代码位置"><a href="#一-代码位置" class="headerlink" title="一.代码位置"></a>一.代码位置</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/itemuse/AlarmManagerClock">AlarmManagerClock</a><br>此文是在此基础上做的讲解,用于加深印象</li>
</ul>
<h3 id="二-界面截图"><a href="#二-界面截图" class="headerlink" title="二.界面截图"></a>二.界面截图</h3><img src="/2018/07/21/2021-03-06-%E8%A7%A3%E8%AF%BB%E9%97%B9%E9%92%9F%E4%BB%A3%E7%A0%81/ui.png" class title="This is an example image">

<h3 id="三-类"><a href="#三-类" class="headerlink" title="三.类"></a>三.类</h3><ul>
<li><p><strong>AlarmActivity.java</strong><br>是处理弹出提示窗口的一个Activity；</p>
</li>
<li><p><strong>AlarmAlertActivity.java</strong><br>Main类，设置时间周期等操作</p>
</li>
<li><p><strong>AlarmOpreation.java</strong><br>核心逻辑处理类，负责计算周期时间，然后将时间通过AlarmManager发送定时广播；</p>
</li>
<li><p><strong>AlarmReceiver.java</strong><br>广播类，负责处理3发送的广播类型，弹出1；</p>
</li>
<li><p><strong>AlarmsSetting.java</strong><br>设置的时间信息的存取类；</p>
</li>
<li><p><strong>SharedPreferenceUtil.java</strong><br>配合5的一个存储类；</p>
</li>
<li><p><strong>TimePickerFragment.java</strong><br>设置时间的工具类；</p>
</li>
<li><p><strong>WeekGridAdpter.java</strong><br>设置星期的工具类；</p>
</li>
</ul>
<h3 id="四-顺着去看"><a href="#四-顺着去看" class="headerlink" title="四.顺着去看"></a>四.顺着去看</h3><p><strong>核心api：Android原生定时器AlarmManager</strong></p>
<ul>
<li>从<strong>AlarmActivity</strong>点击时间开始</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">	public void onClick(View v) &#123;</span><br><span class="line">		switch (v.getId()) &#123;</span><br><span class="line">		case R.id.switch_in: //上班打卡开关</span><br><span class="line">			if (v.isSelected()) &#123;</span><br><span class="line">				alarmsSetting.setInEnble(false);</span><br><span class="line">				v.setSelected(false);</span><br><span class="line">				AlarmOpreation.cancelAlert(AlarmActivity.this, AlarmsSetting.ALARM_SETTING_TYPE_IN);</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				alarmsSetting.setInEnble(true);</span><br><span class="line">				v.setSelected(true);</span><br><span class="line">				AlarmOpreation.enableAlert(AlarmActivity.this, AlarmsSetting.ALARM_SETTING_TYPE_IN, alarmsSetting);</span><br><span class="line">			&#125;</span><br><span class="line">			break;</span><br><span class="line">		case R.id.switch_out://下班打卡开关</span><br><span class="line">			if (v.isSelected()) &#123;</span><br><span class="line">				alarmsSetting.setOutEnble(false);</span><br><span class="line">				v.setSelected(false);</span><br><span class="line">				AlarmOpreation.cancelAlert(AlarmActivity.this, AlarmsSetting.ALARM_SETTING_TYPE_OUT);</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				alarmsSetting.setOutEnble(true);</span><br><span class="line">				v.setSelected(true);</span><br><span class="line">				AlarmOpreation.enableAlert(AlarmActivity.this, AlarmsSetting.ALARM_SETTING_TYPE_OUT, alarmsSetting);</span><br><span class="line">			&#125;</span><br><span class="line">			break;</span><br><span class="line">		case R.id.set_in_time: //设置上班时间</span><br><span class="line">			showTimePickerDialog(AlarmsSetting.ALARM_SETTING_TYPE_IN);</span><br><span class="line">			break;</span><br><span class="line">		case R.id.set_out_time://设置下班时间</span><br><span class="line">			showTimePickerDialog(AlarmsSetting.ALARM_SETTING_TYPE_OUT);</span><br><span class="line">			break;</span><br><span class="line">		case R.id.btn_dynamic: //灵活打卡</span><br><span class="line">			showSingSelect();</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>其中设置时间的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public void showTimePickerDialog(final int type) &#123;</span><br><span class="line">	TimePickerFragment timePicker = new TimePickerFragment();</span><br><span class="line">	if (type == AlarmsSetting.ALARM_SETTING_TYPE_IN) &#123;</span><br><span class="line">		timePicker.setTime(alarmsSetting.getInHour(), alarmsSetting.getInMinutes());</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		timePicker.setTime(alarmsSetting.getOutHour(), alarmsSetting.getOutMinutes());</span><br><span class="line">	&#125;</span><br><span class="line">	timePicker.show(getFragmentManager(), &quot;timePicker&quot;);</span><br><span class="line">	timePicker.setOnSelectListener(new TimePickerFragment.OnSelectListener() &#123;</span><br><span class="line">		@Override</span><br><span class="line">		public void getValue(int hourOfDay, int minute) &#123;</span><br><span class="line">			setTime1(type,hourOfDay,minute);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>TimePickerFragment窗口</strong><br>此类实质上就是继承至 <strong>DialogFragment</strong>调用 TimePickerDialog向外提供获取小时和分钟的接口！</li>
<li><strong>WeekGridAdpter.java</strong><br>而星期的周期复杂些，此行星期选项列表是一排 GridView,WeekGridAdpter就是它的 Adapter，在构造方法的 GetView中，可以看出，大神将周一至周日，组成一个二进制数据：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">if(v.isSelected())&#123;</span><br><span class="line">    selected = selected - (int)(1 &lt;&lt; position);</span><br><span class="line">    if(selected &lt;= 0) &#123;//至少选一个</span><br><span class="line">        selected = selected + (int)(1 &lt;&lt; position);</span><br><span class="line">        return ;</span><br><span class="line">    &#125;</span><br><span class="line">    v.setSelected(false);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    selected = selected + (int)(1 &lt;&lt; position);</span><br><span class="line">    v.setSelected(true);</span><br><span class="line">&#125;</span><br><span class="line">if(type==AlarmsSetting.ALARM_SETTING_TYPE_IN)&#123;</span><br><span class="line">    alarmsSetting.setInDays(selected);</span><br><span class="line">&#125;else if(type==AlarmsSetting.ALARM_SETTING_TYPE_OUT)&#123;</span><br><span class="line">    alarmsSetting.setOutDays(selected);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>传入对应参数到<strong>AlarmOpreation</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AlarmOpreation.cancelAlert(context,type);</span><br><span class="line">AlarmOpreation.enableAlert(context, type, alarmsSetting);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>AlarmOpreation.class</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">释放</span><br><span class="line">**/</span><br><span class="line">public static void cancelAlert(Context context, int type) &#123;</span><br><span class="line">		AlarmManager mAlarmManager = (AlarmManager)</span><br><span class="line">				context.getSystemService(Context.ALARM_SERVICE);</span><br><span class="line">		Intent intent = new Intent(AlarmsSetting.ALARM_ALERT_ACTION);</span><br><span class="line">		intent.putExtra(&quot;type&quot;, type);</span><br><span class="line">		intent.setClass(context, AlarmReceiver.class);</span><br><span class="line">		PendingIntent pi = PendingIntent.getBroadcast(context, type, intent,</span><br><span class="line">				PendingIntent.FLAG_CANCEL_CURRENT);</span><br><span class="line">		mAlarmManager.cancel(pi);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置:主要是将存储好的时间设置信息（小时，分钟，星期），通过 cacluteNextAlarm方法设置成一个特殊的 Calendar值用于定时，然后将对应的 type和 Action组成一个通过广播 pi！通过 AlarmManager的 set方法定时， mAlarmManager.set(AlarmManager.RTC_WAKEUP,mCalendar.getTimeInMillis(),pi);，定时将 pi中的内容发送出去！<br>核心就是这样！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">设置</span><br><span class="line">**/</span><br><span class="line">public static void enableAlert(Context context, int type, AlarmsSetting alarmsSetting) &#123;</span><br><span class="line">		if(type==AlarmsSetting.ALARM_SETTING_TYPE_IN &amp;&amp; !alarmsSetting.isInEnble())&#123;</span><br><span class="line">			return ;</span><br><span class="line">		&#125;else if(type==AlarmsSetting.ALARM_SETTING_TYPE_OUT &amp;&amp; !alarmsSetting.isOutEnble())&#123;</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		int rantime = alarmsSetting.getDynamic();</span><br><span class="line">		AlarmManager mAlarmManager = (AlarmManager)</span><br><span class="line">				context.getSystemService(Context.ALARM_SERVICE);</span><br><span class="line">		int hours = 0,minute=0,dayOfweek=0;</span><br><span class="line">		if(type==AlarmsSetting.ALARM_SETTING_TYPE_IN)&#123;</span><br><span class="line">			hours = alarmsSetting.getInHour();</span><br><span class="line">			minute=alarmsSetting.getInMinutes();</span><br><span class="line">			dayOfweek = alarmsSetting.getInDays();</span><br><span class="line">		&#125;else if(type==AlarmsSetting.ALARM_SETTING_TYPE_OUT)&#123;</span><br><span class="line">			hours = alarmsSetting.getOutHour();</span><br><span class="line">			minute=alarmsSetting.getOutMinutes();</span><br><span class="line">			dayOfweek=alarmsSetting.getOutDays();</span><br><span class="line">		&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>处理成循环周期</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">public static Calendar cacluteNextAlarm(int hour, int minute, int dayOfweek)&#123;</span><br><span class="line">	Calendar mCalendar = Calendar.getInstance();</span><br><span class="line">	mCalendar.setTimeInMillis(System.currentTimeMillis());</span><br><span class="line">	mCalendar.set(Calendar.HOUR_OF_DAY,hour);</span><br><span class="line">	mCalendar.set(Calendar.MINUTE, minute);</span><br><span class="line">	int differDays = getNextAlarmDifferDays(dayOfweek,mCalendar.get(Calendar.DAY_OF_WEEK), mCalendar.getTimeInMillis());</span><br><span class="line">	int nextYear = getNextAlarmYear(mCalendar.get(Calendar.YEAR), mCalendar.get(Calendar.DAY_OF_YEAR), mCalendar.getActualMaximum(Calendar.DAY_OF_YEAR), differDays);</span><br><span class="line">	int nextMonth = getNextAlarmMonth(mCalendar.get(Calendar.MONTH), mCalendar.get(Calendar.DAY_OF_MONTH), mCalendar.getActualMaximum(Calendar.DATE), differDays);</span><br><span class="line">	int nextDay = getNextAlarmDay(mCalendar.get(Calendar.DAY_OF_MONTH), mCalendar.getActualMaximum(Calendar.DATE), differDays);</span><br><span class="line">	mCalendar.set(Calendar.YEAR,nextYear);</span><br><span class="line">	mCalendar.set(Calendar.MONTH, nextMonth % 12);//月份从0开始</span><br><span class="line">	mCalendar.set(Calendar.DAY_OF_MONTH, nextDay);</span><br><span class="line">	mCalendar.set(Calendar.SECOND, 0);</span><br><span class="line">	mCalendar.set(Calendar.MILLISECOND, 0);</span><br><span class="line">	return mCalendar;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">//获取下次闹钟相差的天数</span><br><span class="line">private static int getNextAlarmDifferDays(int data, int currentDayOfWeek,long timeInMills)&#123;</span><br><span class="line">	int nextDayOfWeek =  getNextDayOfWeek(data, currentDayOfWeek,timeInMills);</span><br><span class="line">	return currentDayOfWeek&lt;=nextDayOfWeek?(nextDayOfWeek-currentDayOfWeek):(7 - currentDayOfWeek + nextDayOfWeek);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//考虑年进位的情况</span><br><span class="line">private static int getNextAlarmYear(int year,int dayOfYears, int actualMaximum, int differDays) &#123;</span><br><span class="line">	int temp = actualMaximum-dayOfYears-differDays;</span><br><span class="line">	return temp &gt;= 0?year:year+1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//考虑月进位的情况</span><br><span class="line">private static int getNextAlarmMonth(int month,int dayOfMonth,int actualMaximum, int differDays) &#123;</span><br><span class="line">	int temp = actualMaximum-dayOfMonth-differDays;</span><br><span class="line">	return temp &gt;= 0?month:month+1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//获取下次闹钟的day</span><br><span class="line">private static int getNextAlarmDay(int thisDayOfMonth, int actualMaximum, int differDays) &#123;</span><br><span class="line">	int temp = actualMaximum - thisDayOfMonth-differDays;</span><br><span class="line">	if (temp&lt;0)&#123;</span><br><span class="line">		return thisDayOfMonth + differDays - actualMaximum;</span><br><span class="line">	&#125;</span><br><span class="line">	return thisDayOfMonth + differDays;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//获取下次显示是星期几</span><br><span class="line">private static int getNextDayOfWeek(int data, int cWeek,long timeInMillis) &#123;</span><br><span class="line">	int tempBack = data &gt;&gt; cWeek - 1;</span><br><span class="line">	int tempFront = data ;</span><br><span class="line"></span><br><span class="line">	if(tempBack%2==1)&#123;</span><br><span class="line">		if(System.currentTimeMillis()&lt;timeInMillis)  return cWeek;</span><br><span class="line">	&#125;</span><br><span class="line">	tempBack = tempBack&gt;&gt;1;</span><br><span class="line">		int m=1,n=0;</span><br><span class="line">		while (tempBack != 0) &#123;</span><br><span class="line">			if (tempBack % 2 == 1 ) return cWeek + m;</span><br><span class="line">			tempBack = tempBack / 2;</span><br><span class="line">			m++;</span><br><span class="line">		&#125;</span><br><span class="line">		while(n&lt;cWeek)&#123;</span><br><span class="line">			if (tempFront % 2 == 1)  return n+1;</span><br><span class="line">			tempFront =tempFront/2;</span><br><span class="line">			n++;</span><br><span class="line">		&#125;</span><br><span class="line">		return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后通过<strong>SharedPreferenceUtil</strong>将设置的值存储下来</p>
<p>当设置好定时器后，系统就会在指定的时间发送广播过来通知</p>
<ul>
<li><strong>AlarmReceiver.class</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">        alarmsSetting = new AlarmsSetting(context);</span><br><span class="line">        int type = intent.getIntExtra(&quot;type&quot;,0);</span><br><span class="line">//        Log.e(&quot;#######################&quot;, &quot;getRecevier_ACtion&quot; + intent.getAction());</span><br><span class="line"></span><br><span class="line">        //如果已经设置闹钟w不可用，先拦截</span><br><span class="line">        if(type==AlarmsSetting.ALARM_SETTING_TYPE_IN &amp;&amp; !alarmsSetting.isInEnble())&#123;</span><br><span class="line">            return ;</span><br><span class="line">        &#125;else if(type==AlarmsSetting.ALARM_SETTING_TYPE_OUT &amp;&amp; !alarmsSetting.isOutEnble())&#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if(intent.getAction().equals(AlarmsSetting.ALARM_ALERT_ACTION) &amp;&amp; type !=0) &#123;</span><br><span class="line">            SimpleDateFormat formatter = new SimpleDateFormat(&quot;yyyy年MM月dd日——HH时mm分ss秒SSS毫秒&quot;);</span><br><span class="line">            Log.e(&quot;###########此次闹钟#######&quot;, &quot;alarmsSetting.getNextAlarm()&quot; + formatter.format(new Date(alarmsSetting.getNextAlarm())));</span><br><span class="line">            Log.e(&quot;###########当前系统时间###&quot;, &quot;System.currentTimeMillis()&quot; + formatter.format(new Date(System.currentTimeMillis())));</span><br><span class="line">            if (alarmsSetting.getNextAlarm() + 1000 * 30 &lt; System.currentTimeMillis())&#123;//解决闹钟广播比设置时间闹钟快的问题</span><br><span class="line">                Log.e(&quot;###########无效闹钟#######&quot;, &quot;不执行&quot;);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            Log.e(&quot;###########准备弹出提示框###&quot;, &quot; &quot;);</span><br><span class="line">            intent.setClass(context, AlarmAlertActivity.class);</span><br><span class="line">            intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">            context.startActivity(intent);</span><br><span class="line">            AlarmOpreation.cancelAlert(context, type);</span><br><span class="line">            AlarmOpreation.enableAlert(context, type, new AlarmsSetting(context));</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            AlarmOpreation.cancelAlert(context,  AlarmsSetting.ALARM_SETTING_TYPE_IN);</span><br><span class="line">            AlarmOpreation.enableAlert(context,  AlarmsSetting.ALARM_SETTING_TYPE_IN, new AlarmsSetting(context));</span><br><span class="line">            AlarmOpreation.cancelAlert(context,  AlarmsSetting.ALARM_SETTING_TYPE_OUT);</span><br><span class="line">            AlarmOpreation.enableAlert(context,  AlarmsSetting.ALARM_SETTING_TYPE_OUT, new AlarmsSetting(context));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/01/17/2021-03-07-MarkDown%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="项勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自由侠">
      <meta itemprop="description" content="万里苍穹，星辰大海">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 自由侠">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/01/17/2021-03-07-MarkDown%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/" class="post-title-link" itemprop="url">MarkDown基本语法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-01-17 18:04:11" itemprop="dateCreated datePublished" datetime="2018-01-17T18:04:11+08:00">2018-01-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-30 21:57:31" itemprop="dateModified" datetime="2023-01-30T21:57:31+08:00">2023-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MarkDown/" itemprop="url" rel="index"><span itemprop="name">MarkDown</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="MarkDown基本语法" href="/2018/01/17/2021-03-07-MarkDown%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::fd53a931058ad6ae46b6de82d6c47927" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一-Markdown"><a href="#一-Markdown" class="headerlink" title="一.Markdown"></a>一.Markdown</h3><p>是一种纯文本格式的标记语言。通过简单的标记语法，它可以使普通文本内容具有一定的格式。</p>
<h3 id="二-代码"><a href="#二-代码" class="headerlink" title="二.代码"></a>二.代码</h3><ol>
<li><p><strong>单行代码：</strong><br>代码之间分别用一个反引号包起来<br><strong>示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`create database hero;`</span><br></pre></td></tr></table></figure>
<p><strong>效果</strong><br><code>create database hero;</code></p>
</li>
<li><p><strong>代码块：</strong><br>代码之间分别用三个反引号包起来，且两边的反引号单独占一行<br><strong>示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(```)</span><br><span class="line">    function fun()&#123;</span><br><span class="line">         echo &quot;这是一句非常牛逼的代码&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    fun();</span><br><span class="line">(```)</span><br></pre></td></tr></table></figure>
<p><strong>效果如下：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function fun()&#123;</span><br><span class="line">     echo &quot;这是一句非常牛逼的代码&quot;;</span><br><span class="line">&#125;</span><br><span class="line">fun();</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="三-字体"><a href="#三-字体" class="headerlink" title="三.字体"></a>三.字体</h3><ol>
<li><p><strong>加粗</strong><br>要加粗的文字左右分别用两个*号包起来</p>
</li>
<li><p><strong>斜体</strong><br>要倾斜的文字左右分别用一个*号包起来</p>
</li>
<li><p><strong>斜体加粗</strong><br>要倾斜和加粗的文字左右分别用三个*号包起来</p>
</li>
<li><p><strong>删除线</strong><br>要加删除线的文字左右分别用两个~~号包起来</p>
</li>
</ol>
<p><strong>示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">**这是加粗的文字**</span><br><span class="line">*这是倾斜的文字*`</span><br><span class="line">***这是斜体加粗的文字***</span><br><span class="line">~~这是加删除线的文字~~</span><br></pre></td></tr></table></figure>
<p><strong>效果如下：</strong></p>
<p>  <strong>这是加粗的文字</strong><br><em>这是倾斜的文字</em>&#96;<br><em><strong>这是斜体加粗的文字</strong></em><br><del>这是加删除线的文字</del></p>
<h3 id="四-引用"><a href="#四-引用" class="headerlink" title="四.引用"></a>四.引用</h3><p>在引用的文字前加&gt;即可。引用也可以嵌套，如加两个&gt;&gt;三个&gt;&gt;&gt;<br>n个…<br>貌似可以一直加下去，但没神马卵用</p>
<p><strong>示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;这是引用的内容</span><br><span class="line">&gt;&gt;这是引用的内容</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;这是引用的内容</span><br></pre></td></tr></table></figure>
<p><strong>效果如下：</strong></p>
<blockquote>
<p>这是引用的内容</p>
<blockquote>
<p>这是引用的内容</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>这是引用的内容</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<h3 id="五-分割线"><a href="#五-分割线" class="headerlink" title="五.分割线"></a>五.分割线</h3><p>三个 - 或者 * 都可以。</p>
<p><strong>示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">***</span><br></pre></td></tr></table></figure>

<p><strong>效果如下：</strong></p>
<hr>
<hr>
<p>可以看到，显示效果是一样的。</p>
<h3 id="六-图片"><a href="#六-图片" class="headerlink" title="六.图片"></a>六.图片</h3><p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">![图片alt](图片地址 &#x27;&#x27;图片title&#x27;&#x27;)</span><br><span class="line">&#123;% asset_img img1.png This is an example image %&#125;</span><br></pre></td></tr></table></figure>
<p>图片alt就是显示在图片下面的文字，相当于对图片内容的解释。<br>图片title是图片的标题，当鼠标移到图片上时显示的内容。title可加可不加<br><strong>示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">![blockchain](https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/</span><br><span class="line">u=702257389,1274025419&amp;fm=27&amp;gp=0.jpg &quot;区块链&quot;)</span><br></pre></td></tr></table></figure>
<p><strong>效果如下：</strong><br>![blockchain](<a target="_blank" rel="noopener" href="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/">https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/</a><br>u&#x3D;702257389,1274025419&amp;fm&#x3D;27&amp;gp&#x3D;0.jpg “区块链”)</p>
<p>上传本地图片直接点击导航栏的图片标志，选择图片即可</p>
<h3 id="七-超链接"><a href="#七-超链接" class="headerlink" title="七.超链接"></a>七.超链接</h3><p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[超链接名](超链接地址 &quot;超链接title&quot;)</span><br></pre></td></tr></table></figure>
<p>title可加可不加<br><strong>示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[简书](http://jianshu.com)</span><br><span class="line">[百度](http://baidu.com)</span><br></pre></td></tr></table></figure>
<p><strong>效果如下：</strong></p>
<p><a target="_blank" rel="noopener" href="http://jianshu.com/">简书</a><br><a target="_blank" rel="noopener" href="http://baidu.com/">百度</a></p>
<h3 id="八-列表"><a href="#八-列表" class="headerlink" title="八.列表"></a>八.列表</h3><ol>
<li><strong>无序列表</strong><br><strong>语法：</strong><br>无序列表用 - + * 任何一种都可以<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- 列表内容</span><br><span class="line">+ 列表内容</span><br><span class="line">* 列表内容</span><br></pre></td></tr></table></figure>
注意：- + * 跟内容之间都要有一个空格</li>
</ol>
<p>  <strong>效果如下：</strong></p>
<ul>
<li>列表内容</li>
</ul>
<ul>
<li>列表内容</li>
</ul>
<ul>
<li>列表内容</li>
</ul>
<ol start="2">
<li><p><strong>有序列表</strong><br><strong>语法：</strong><br>数字加点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 列表内容</span><br><span class="line">2. 列表内容</span><br><span class="line">3. 列表内容</span><br></pre></td></tr></table></figure>
<p>注意：序号跟内容之间要有空格<br><strong>效果如下：</strong></p>
</li>
<li><p>列表内容</p>
</li>
<li><p>列表内容</p>
</li>
<li><p>列表内容</p>
</li>
<li><p><strong>列表嵌套</strong><br>上一级和下一级之间敲三个空格即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 一级无序列表内容</span><br><span class="line">   - 二级无序列表内容</span><br><span class="line">   - 二级无序列表内容</span><br><span class="line">   - 二级无序列表内容</span><br></pre></td></tr></table></figure>
<p><strong>效果如下</strong></p>
<ul>
<li>一级无序列表内容<ul>
<li>二级无序列表内容</li>
<li>二级无序列表内容</li>
<li>二级无序列表内容</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 一级有序列表内容</span><br><span class="line">   - 二级无序列表内容</span><br><span class="line">   - 二级无序列表内容</span><br><span class="line">2. 一级有序列表内容</span><br><span class="line">   - 二级无序列表内容</span><br><span class="line">   - 二级无序列表内容</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>效果如下</strong></p>
<ol>
<li>一级有序列表内容<ul>
<li>二级无序列表内容</li>
<li>二级无序列表内容</li>
</ul>
</li>
<li>一级有序列表内容<ul>
<li>二级无序列表内容</li>
<li>二级无序列表内容</li>
</ul>
</li>
</ol>
<h3 id="九-表格"><a href="#九-表格" class="headerlink" title="九.表格"></a>九.表格</h3><p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">表头|表头|表头</span><br><span class="line">---|:--:|---:</span><br><span class="line">内容|内容|内容</span><br><span class="line">内容|内容|内容</span><br></pre></td></tr></table></figure>
<p><strong>第二行分割表头和内容。</strong></p>
<ul>
<li>两边加：表示文字居中</li>
<li>右边加：表示文字居右<br>注：原生的语法两边都要用 | 包起来。此处省略</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">姓名|最强技能|排位名次</span><br><span class="line">--|:--:|--:</span><br><span class="line">刘备|哭|大哥</span><br><span class="line">关羽|打|二哥</span><br><span class="line">张飞|骂|三弟</span><br></pre></td></tr></table></figure>
<p><strong>效果如下：</strong></p>
<table>
<thead>
<tr>
<th>姓名</th>
<th align="center">最强技能</th>
<th align="right">排位名次</th>
</tr>
</thead>
<tbody><tr>
<td>刘备</td>
<td align="center">哭</td>
<td align="right">大哥</td>
</tr>
<tr>
<td>关羽</td>
<td align="center">打</td>
<td align="right">二哥</td>
</tr>
<tr>
<td>张飞</td>
<td align="center">骂</td>
<td align="right">三弟</td>
</tr>
</tbody></table>
<h3 id="十-标题"><a href="#十-标题" class="headerlink" title="十.标题"></a>十.标题</h3><p>在想要设置为标题的文字前面加#来表示<br>一个#是一级标题，二个#是二级标题，以此类推。支持六级标题。</p>
<p><strong>注：</strong>标准语法一般在#后跟个空格再写文字，貌似简书不加空格也行。</p>
<p><strong>示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 这是一级标题</span><br><span class="line">## 这是二级标题</span><br><span class="line">### 这是三级标题</span><br><span class="line">#### 这是四级标题</span><br><span class="line">##### 这是五级标题</span><br><span class="line">###### 这是六级标题</span><br></pre></td></tr></table></figure>
<p><strong>效果如下：</strong></p>
<h1 id="这是一级标题"><a href="#这是一级标题" class="headerlink" title="这是一级标题"></a>这是一级标题</h1><h2 id="这是二级标题"><a href="#这是二级标题" class="headerlink" title="这是二级标题"></a>这是二级标题</h2><h3 id="这是三级标题"><a href="#这是三级标题" class="headerlink" title="这是三级标题"></a>这是三级标题</h3><h4 id="这是四级标题"><a href="#这是四级标题" class="headerlink" title="这是四级标题"></a>这是四级标题</h4><h5 id="这是五级标题"><a href="#这是五级标题" class="headerlink" title="这是五级标题"></a>这是五级标题</h5><h6 id="这是六级标题"><a href="#这是六级标题" class="headerlink" title="这是六级标题"></a>这是六级标题</h6><hr>
<p>整理自<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/191d1e21f7edhttps://www.jianshu.com/p/191d1e21f7ed">简书</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/12/21/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="项勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自由侠">
      <meta itemprop="description" content="万里苍穹，星辰大海">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 自由侠">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/21/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">Activity基础篇-保存数据</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-21 11:20:24" itemprop="dateCreated datePublished" datetime="2017-12-21T11:20:24+08:00">2017-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-30 21:58:24" itemprop="dateModified" datetime="2023-01-30T21:58:24+08:00">2023-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Activity基础篇-保存数据" href="/2017/12/21/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::71cb1cb3a8f6709bdd7d412f1d80db2a" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一-有哪些状态是需要保存的"><a href="#一-有哪些状态是需要保存的" class="headerlink" title="一.有哪些状态是需要保存的"></a>一.有哪些状态是需要保存的</h3><p>有哪些状态是需要保存的呢？最简单明了的就是对一些数据的保存，比如你正在操作一些数据，当面临突发情况，你的数据还没有操作完，这时候你就需要将数据进行保存，以便我们再次回到这个页面的时候不用重头再来。</p>
<h3 id="二-什么情况下需要Activity状态的保存与恢复"><a href="#二-什么情况下需要Activity状态的保存与恢复" class="headerlink" title="二.什么情况下需要Activity状态的保存与恢复"></a>二.什么情况下需要Activity状态的保存与恢复</h3><p>那么在什么情况下需要对Activity的状态进行保存与恢复呢？官方文档的说法是在处理运行时配置变更的时候，来看官方文档介绍的一段话<br>有些设备配置可能会在运行时发生变化（例如屏幕方向、键盘可用性及语言）。 发生这种变化时，Android 会重启正在运行的 Activity（先后调用 onDestroy() 和 onCreate()）。重启行为旨在通过利用与新设备配置匹配的备用资源自动重新加载您的应用，来帮助它适应新配置。<br>要妥善处理重启行为，Activity 必须通过常规的Activity 生命周期恢复其以前的状态，在 Activity 生命周期中，Android 会在销毁 Activity 之前调用 onSaveInstanceState()，以便您保存有关应用状态的数据。 然后，您可以在 onCreate() 或 onRestoreInstanceState() 期间恢复 Activity 状态。<br>这里面提到了各种回调方法，其中也有本文介绍的重点，不急，我们一步步来，首先我总结有如下几种情况是需要对数据进行保存的 </p>
<ul>
<li>点击了返回键 </li>
<li>锁屏 </li>
<li>点击home键 </li>
<li>有其他APP进入前台（比如接听电话） </li>
<li>启动了新的Activity </li>
<li>屏幕方向发生旋转 </li>
<li>APP被杀死</li>
</ul>
<h3 id="三-状态为什么会丢失"><a href="#三-状态为什么会丢失" class="headerlink" title="三.状态为什么会丢失"></a>三.状态为什么会丢失</h3><p>紧接着，我们来说一下为什么状态会丢失，这里面到底发什么了什么操作？这里我们用代码来演示一下，就是一个Activity，我们复写它的onCreat和onDestroy方法，分别打上log，然后启动再点击旋转屏幕（本文主要以屏幕旋转为例）看看这个过程方法是如何执行的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">11-25 12:51:27.419 4153-4153/com.ithuangqing.activitysavedemo D/mainactivity--vv: onCreate</span><br><span class="line">11-25 12:51:33.459 4153-4153/com.ithuangqing.activitysavedemo D/mainactivity--vv: onDestroy</span><br><span class="line">11-25 12:51:33.539 4153-4153/com.ithuangqing.activitysavedemo D/mainactivity--vv: onCreate</span><br></pre></td></tr></table></figure>
<p>我们从log中可知，当应用启动，首先运行onCreat方法，当我们点击旋转屏幕会发现当前的Activity被销毁了，然后又重新执行了onCreat方法，这是怎么回事，Activity发生了什么样的变化呢？我们在log中打印出当前Activity的hashcodekankan。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">11-25 12:57:20.934 4439-4439/com.ithuangqing.activitysavedemo D/mainactivity--vv: onCreatecom.ithuangqing.activitysavedemo.MainActivity@4a79f318</span><br><span class="line">11-25 12:57:26.184 4439-4439/com.ithuangqing.activitysavedemo D/mainactivity--vv: onDestroycom.ithuangqing.activitysavedemo.MainActivity@4a79f318</span><br><span class="line">11-25 12:57:26.224 4439-4439/com.ithuangqing.activitysavedemo D/mainactivity--vv: onCreatecom.ithuangqing.activitysavedemo.MainActivity@4a7d4274</span><br></pre></td></tr></table></figure>
<p>原来当点击了屏幕旋转之后，当前Activity会被销毁，然后会重新创建一个新的Activity，如此一来我们在之前Activity的数据如果不保存的话就又可能丢失了。<br>好了，到了这一步你至少要明白这么一件事，就是当在第二部分中说的几种情况出现时比如屏幕发生旋转，当前的Activity会被销毁而且会重新创建一个全新的Activity。<br>下面我们举一个数据丢失的例子，让你看的更清楚。首先设置布局，布局很简单，一个文本框，一个按钮，给按钮设置一个点击事件，点击按钮让文本框中的数字从一递增。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    mMNumber = findViewById(R.id.number);</span><br><span class="line">    mBtAdd = findViewById(R.id.btAdd);</span><br><span class="line">    mBtAdd.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onClick(View v) &#123;</span><br><span class="line">            a = ++a;</span><br><span class="line">            mMNumber.setText(&quot;&quot;+a);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    Log.d(TAG, &quot;onCreate&quot;+this);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行之后点击按钮，如图</p>
<img src="/2017/12/21/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/0.png" class title="This is an example image">

<p>现在文本框中的数字是5，接下来我们点击屏幕旋转看看会发生什么，如图</p>
<img src="/2017/12/21/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/1.png" class title="This is an example image">

<p>果不其然，数据丢失了。</p>
<h3 id="四-如何保存与恢复"><a href="#四-如何保存与恢复" class="headerlink" title="四.如何保存与恢复"></a>四.如何保存与恢复</h3><p>既然数据会丢失，那么我们该如何保存数据，或者如何解决这些问题呢？我们拿屏幕旋转这个变更来说，首先我们知道，如果屏幕发生旋转，当前Activity会被销毁，因此我们可以限定屏幕的方向，这样一来即使我们点击屏幕旋转，屏幕的方向是没有发什么变化的，所以Activity不会被销毁，数据自然不会丢失，另外一种方法就是我们可以自己处理变更，我们可以在当前的Activity的配置文件中添加这么一行代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:configChanges=&quot;orientation|screenSize|keyboard&quot;</span><br></pre></td></tr></table></figure>
<p>这句代码的意思就是告诉系统我们自己来处理变更，这两种方法不是今天的主菜，真正的主菜是onSaveInstanceState和onRestoreInstanceState，终于说到我们的重点了，我相信看完本文的介绍，大家会对这个东西有种终于认识的感觉，那就是每次创建Axtivity中自动创建的onCreat方法中的参数。首先我们在我们的Acticiry中复写 onSaveInstanceState 和 onRestoreInstanceState 同时打上log。看一下 输出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">11-25 13:38:57.383 5242-5242/com.ithuangqing.activitysavedemo D/mainactivity--vv: onCreate</span><br><span class="line">11-25 13:39:13.133 5242-5242/com.ithuangqing.activitysavedemo D/mainactivity--vv: onSaveInstanceState</span><br><span class="line">11-25 13:39:13.133 5242-5242/com.ithuangqing.activitysavedemo D/mainactivity--vv: onDestroy</span><br><span class="line">11-25 13:39:13.163 5242-5242/com.ithuangqing.activitysavedemo D/mainactivity--vv: onCreate</span><br><span class="line">11-25 13:39:13.163 5242-5242/com.ithuangqing.activitysavedemo D/mainactivity--vv: onRestoreInstanceState</span><br></pre></td></tr></table></figure>
<p>从log中我们可以看到，当我们点击屏幕旋转之后，在当前Activity被销毁之前会调用onSaveInstanceState，然后销毁当前Activity，创建新的Activity之后会调用onCreat方法之后会紧接着调用onRestoreInstanceState，那么这两个方法有什么用呢？其实也可以猜到，onSaveInstanceState是用来保存我们当前activity中的数据的，而onRestoreInstanceState可以让我们获取之前保存的数据从而在新的activity中进行设置。<br>那数据以何种形式进行保存呢？我们来看下这两个函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> @Override</span><br><span class="line"> public void onSaveInstanceState(Bundle outState) &#123;</span><br><span class="line">     super.onSaveInstanceState(outState);</span><br><span class="line">     //保存销毁之前的数据</span><br><span class="line"></span><br><span class="line">     Log.d(TAG, &quot;onSaveInstanceState&quot;);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line"> protected void onRestoreInstanceState(Bundle savedInstanceState) &#123;</span><br><span class="line">     super.onRestoreInstanceState(savedInstanceState);</span><br><span class="line">     Log.d(TAG, &quot;onRestoreInstanceState&quot;);   </span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p>我们发现他们的参数是Bundle，有印象了吧！我们就是通过Bundle来进行数据保存和读取的，大家都知道这是一种键值对的保存与读取方式。<br>接下来再看一个函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    mMNumber = findViewById(R.id.number);</span><br><span class="line">    mBtAdd = findViewById(R.id.btAdd);</span><br><span class="line">    mBtAdd.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onClick(View v) &#123;</span><br><span class="line">            a = ++a;</span><br><span class="line">            mMNumber.setText(&quot;&quot;+a);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    Log.d(TAG, &quot;onCreate&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看看onCreat函数的参数，你发现了什么嘛？前面说过我们可以在onRestoreInstanceState中通过Bundle拿到我们之前保存的数据，其实在onCreat中也能达到相同的效果。<br>下面我们就具体代码演示一遍吧！<br>首先是在onSaveInstanceState中保存数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void onSaveInstanceState(Bundle outState) &#123;</span><br><span class="line">      super.onSaveInstanceState(outState);</span><br><span class="line">      //保存销毁之前的数据</span><br><span class="line">      outState.putString(&quot;number&quot;,mMNumber.getText().toString());</span><br><span class="line">      Log.d(TAG, &quot;onSaveInstanceState&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>紧接着在onRestoreInstanceState对数据进行恢复</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"> protected void onRestoreInstanceState(Bundle savedInstanceState) &#123;</span><br><span class="line">     super.onRestoreInstanceState(savedInstanceState);</span><br><span class="line">     Log.d(TAG, &quot;onRestoreInstanceState&quot;);</span><br><span class="line">     //恢复数据</span><br><span class="line">    String s = savedInstanceState.getString(&quot;number&quot;);</span><br><span class="line">    mMNumber.setText(s);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>接下来运行程序</p>
<img src="/2017/12/21/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/2.png" class title="This is an example image">
<p>然后我们旋转屏幕</p>
<img src="/2017/12/21/2021-03-08-Activity%E5%9F%BA%E7%A1%80%E7%AF%87-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/3.png" class title="This is an example image">

<p>发现数据被成功保留了下来，<br>到这里我们总结一下这个方法的调用过程，当运行时配置发生变更的时候，程序总的会销毁当前的Activity，然后重新创建一个新的Activity，在这个过程中，销毁当前Activity之前会先调用onSaveInstanceState让我们来保存数据，然后重建Activity在调用onCreat方发之后会调用onRestoreInstanceState让我们来对数据进行恢复，当然也可以在onCret中进行数据恢复，方法原理相同。</p>
<h3 id="五-这个知识点你需要注意的地方"><a href="#五-这个知识点你需要注意的地方" class="headerlink" title="五.这个知识点你需要注意的地方"></a>五.这个知识点你需要注意的地方</h3><p>通过以上的讲诉，相信你对Activity状态的保存与恢复已经掌握的差不多了，在这里我再补充几点<br>**关于onSaveInstanceState **</p>
<p>这个方法默认情况下会自动保存有关Activity的视图层次结构的状态信息，简单举个例子，我们以系统控件EditText来说，系统默认会保存有关这个控件的一个信息，也就是当你在这个控件中输入内容的时候，即使旋转屏幕内容也不会丢失，因为系统已经默认为其实现了我们说的那两个方法，但是有个前提，这个控件必须设置id，否则数据依旧会丢失，另外如果你重写了onRestoreInstanceState也要保证必须有这行代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">super.onRestoreInstanceState(savedInstanceState);</span><br></pre></td></tr></table></figure>
<p><strong>关于旋转屏幕无法调用onSaveInstanceState的问题。</strong></p>
<p>出现这种问题你复写的肯定以下方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void onSaveInstanceState (Bundle outState, PersistableBundle outPersistentState)；</span><br></pre></td></tr></table></figure>
<p>改成以下方法即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void onSaveInstanceState (Bundle outState)；</span><br></pre></td></tr></table></figure>

<hr>
<p>来自<a target="_blank" rel="noopener" href="http://blog.csdn.net/sinat_33921105">博客</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">项勇</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  




<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cywvflwLk","appkey":"d695a29e122384601d747339bd6f5df4","count":true}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
